# 车辆定位接口使用说明

本文档说明了基于定位卡车辆定位对接的接口使用方法。

## 配置说明

配置文件位置：`ruoyi-admin/src/main/resources/application.yml`

```yaml
experiment:
  base:
    sw-center:
      status: 1  # 1=启用，0=禁用
      center-ip: http://172.30.17.116:8001/sw-centralOpen-api
    card-analysis:
      vehicle-entry-exit: /api/cardAnalysis/vehicleEntryAndExit
      assignment-record: /api/cardAnalysis/assignmentRecord
      vehicle-track: /api/cardAnalysis/mqVehicleTrackVo
      beacon-push: /api/cardAnalysis/beaconPush
      remove-vehicle: /api/cardAnalysis/removeAssignmentRecord
```

## 接口列表

### 1. 车辆进场、出场推送

**方法：** `vehicleEntryAndExit(VehicleEntryExitRequest request)`

**说明：** 车辆由工作人员驾驶进入货场时，经过大门识别区被视频识别服务捕获并分配生产车辆唯一ID

**使用示例：**
```java
@Autowired
private CenterWorkHttpUtils centerWorkHttpUtils;

public void pushVehicleEntry() {
    VehicleEntryExitRequest request = new VehicleEntryExitRequest();
    request.setType(0);  // 0=进场，1=出场
    request.setVehicleThirdId("TBS20120122102");
    request.setVehicleTime("2024-09-20 12:00:00:001");
    request.setCameraId("摄像机ID");
    request.setThrough("100.67852");  // 经度
    request.setWeft("27.67852");  // 纬度
    request.setRegionType(1);  // 1=地跑、2=J车（火车）、4=轿运车（板车）
    request.setCarType("car");  // "transportCar"=板车、"car"=非板车
    
    // 可选参数
    request.setVehicleCode("车辆VIN码");
    request.setVehicleThirdBrand("车牌");
    request.setVehicleColor("颜色");
    request.setVehicleType("品牌");
    request.setVehicleShape("车型");
    
    JSONObject result = centerWorkHttpUtils.vehicleEntryAndExit(request);
    if (result != null && result.getIntValue("code") == 20000) {
        System.out.println("推送成功");
    }
}
```

### 2. 车辆停放车位、车辆离开车位

**方法：** `assignmentRecord(AssignmentRecordRequest request)`

**说明：** 车辆停放到车位或离开车位时的数据推送

**使用示例：**
```java
public void pushAssignmentRecord() {
    AssignmentRecordRequest request = new AssignmentRecordRequest();
    request.setType(0);  // 0=停放，1=离开
    request.setVehicleThirdId("TBS20120122102");
    request.setVehicleTime("2024-09-20 12:00:00:001");
    request.setCameraId("摄像机ID");
    request.setThrough("100.67852");
    request.setWeft("27.67852");
    request.setRegionType(1);
    request.setCarType("car");
    
    JSONObject result = centerWorkHttpUtils.assignmentRecord(request);
}
```

### 3. 实时轨迹推送

**方法：** `vehicleTrack(VehicleTrackRequest request)`

**说明：** 推送车辆实时轨迹数据

**使用示例：**
```java
public void pushVehicleTrack() {
    VehicleTrackRequest request = new VehicleTrackRequest();
    request.setVehicleThirdId("TBS20120122102");
    request.setVehicleTime("2024-09-20 12:00:00:001");
    request.setCameraId("摄像机ID");
    request.setThrough("100.67852");
    request.setWeft("27.67852");
    request.setCarType("car");
    
    JSONObject result = centerWorkHttpUtils.vehicleTrack(request);
}
```

### 4. UWB推送

**方法：** `beaconPush(BeaconPushRequest request)`

**说明：** RFID绑定UWB信标数据推送，识别车辆距离信标3米内时上报轨迹

**使用示例：**
```java
public void pushBeacon() {
    BeaconPushRequest request = new BeaconPushRequest();
    request.setType(0);  // 0=前进，1=远离
    request.setVehicleTime("2024-09-20 12:00:00:001");
    request.setCameraId("摄像机ID");
    request.setThrough("100.67852");
    request.setWeft("27.67852");
    request.setDistance(10);  // 距离：cm
    
    JSONObject result = centerWorkHttpUtils.beaconPush(request);
}
```

### 5. 车辆删除

**方法：** `removeVehicle(String vehicleThirdId)`

**说明：** 删除车辆记录

**使用示例：**
```java
public void removeVehicle() {
    String vehicleThirdId = "TBS20120122102";
    JSONObject result = centerWorkHttpUtils.removeVehicle(vehicleThirdId);
}
```

## 返回数据格式

所有接口的返回数据格式统一为：

```json
{
  "code": 20000,
  "message": "请求成功",
  "data": {},
  "success": true
}
```

**code 说明：**
- `20000`：请求成功
- `50000`：服务端异常
- `50009`：用户未登录，登录失效，接口鉴权失效

## 领域模型说明

### VehicleEntryExitRequest（进场出场请求）
- type：0=进场，1=出场（必填）
- vehicleThirdId：车辆ID（必填）
- vehicleTime：识别时间 yyyy-MM-dd HH:mm:ss:SSS（必填）
- recordFiles：照片数组（可选）
- cameraId：摄像ID（必填）
- through：经度（必填）
- weft：纬度（必填）
- vehicleCode：车辆VIN码（可选）
- vehicleThirdBrand：车牌（可选）
- vehicleColor：颜色（可选）
- vehicleType：品牌（可选）
- vehicleShape：车型（可选）
- regionType：装卸类型，1=地跑、2=J车（火车）、4=轿运车（板车）（必填）
- carType："transportCar"=板车、"car"=非板车（必填）

### AssignmentRecordRequest（停放/离开车位请求）
参数与 VehicleEntryExitRequest 相同，type：0=停放，1=离开

### VehicleTrackRequest（实时轨迹请求）
- vehicleThirdId：生产车辆ID（必填）
- vehicleTime：时间 yyyy-MM-dd HH:mm:ss:SSS（必填）
- cameraId：摄像机ID（必填）
- through：经度（必填）
- weft：纬度（必填）
- carType："transportCar"=板车、"car"=非板车（必填）

### BeaconPushRequest（UWB推送请求）
- type：0=前进，1=远离（必填）
- vehicleTime：识别时间 yyyy-MM-dd HH:mm:ss:SSS（必填）
- cameraId：摄像ID（必填）
- through：经度（必填）
- weft：纬度（必填）
- distance：距离，单位cm（必填）

## 注意事项

1. 所有时间格式必须严格遵循：`yyyy-MM-dd HH:mm:ss:SSS`
2. 经纬度使用字符串类型
3. `centerStatus` 配置为 `1` 时接口才会真正发送请求
4. 所有接口都会记录详细的日志，便于调试和追踪
5. 接口调用失败会记录错误日志，但不会抛出异常

