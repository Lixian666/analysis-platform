/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.9.2
 * 编译日期：2025-03-07 17:59
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：北京鼎新云科技发展有限公司 ，2025-03-07
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x676d52=_0x4546;(function(_0x3b100c,_0x7988ec){const _0x30204a=_0x4546,_0x2753e6=_0x3b100c();while(!![]){try{const _0xba6f51=-parseInt(_0x30204a(0x19f))/0x1*(-parseInt(_0x30204a(0x147))/0x2)+parseInt(_0x30204a(0x1c5))/0x3+parseInt(_0x30204a(0x1aa))/0x4*(-parseInt(_0x30204a(0x14f))/0x5)+parseInt(_0x30204a(0x14b))/0x6*(-parseInt(_0x30204a(0x1f1))/0x7)+-parseInt(_0x30204a(0x168))/0x8*(parseInt(_0x30204a(0x1c9))/0x9)+-parseInt(_0x30204a(0x187))/0xa*(parseInt(_0x30204a(0x1c1))/0xb)+parseInt(_0x30204a(0x1c3))/0xc;if(_0xba6f51===_0x7988ec)break;else _0x2753e6['push'](_0x2753e6['shift']());}catch(_0x5482fe){_0x2753e6['push'](_0x2753e6['shift']());}}}(_0x487c,0x983a9));function _interopNamespace(_0x4c105c){const _0x4279ce=_0x4546;if(_0x4c105c&&_0x4c105c['__esModule'])return _0x4c105c;var _0x3089ed=Object[_0x4279ce(0x1a8)](null);return _0x4c105c&&Object['keys'](_0x4c105c)['forEach'](function(_0x1703b1){if(_0x1703b1!=='default'){var _0x10f5ae=Object['getOwnPropertyDescriptor'](_0x4c105c,_0x1703b1);Object['defineProperty'](_0x3089ed,_0x1703b1,_0x10f5ae['get']?_0x10f5ae:{'enumerable':!![],'get':function(){return _0x4c105c[_0x1703b1];}});}}),_0x3089ed['default']=_0x4c105c,_0x3089ed;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$2=mars3d__namespace['Cesium'];function getU(_0x432bd1,_0x39e825){const _0x2275e0=_0x4546,_0x4f295f=_0x432bd1*Math['cos'](Cesium$2[_0x2275e0(0x20e)]['toRadians'](_0x39e825));return _0x4f295f;}function getV(_0x1eba7d,_0x55d8aa){const _0x26d4c3=_0x4546,_0x421645=_0x1eba7d*Math['sin'](Cesium$2['Math'][_0x26d4c3(0x16d)](_0x55d8aa));return _0x421645;}function getSpeed(_0x14fbf3,_0x4c07df){const _0x205e05=Math['sqrt'](Math['pow'](_0x14fbf3,0x2)+Math['pow'](_0x4c07df,0x2));return _0x205e05;}function getDirection(_0x34d943,_0x21cadd){const _0x39baea=_0x4546;let _0x37c82c=Cesium$2['Math'][_0x39baea(0x1ec)](Math[_0x39baea(0x18a)](_0x21cadd,_0x34d943));return _0x37c82c+=_0x37c82c<0x0?0x168:0x0,_0x37c82c;}function _0x487c(){const _0x5dc0fe=['resize','initWorker','forEach','_setOptionsHook','uniformMap','windField','fromCache','options','frameRateMonitor','Math','_onMapWhellEvent','particlesTextureSize\x20must\x20be\x20greater\x20than\x200','EventType','segmentsColor','destination-in','WindLayer','particleSystem','framebuffers','fromCssColorString','commandType','now','initFrameRate','tlat','canvasHeight','processWindData','register','values','_speedRate','particlesNumber','previousParticlesPosition','createColorTableTexture','_addedHook','width','bind','canvasContext','4528xRYwIz','mouse_down','speed','xmin','83676NwXiVH','FUNC_ADD','clearCommand','getUVByPoint','4467135IPIBNL','vertexShaderSource','drawingBufferWidth','particlesSpeed','updatePosition','commandList','computing','Cartesian2','speedRate','west','frameRate','steps','canvasWind','primitives','rendering','min','createComputingPrimitives','age','warn','_maxAge','mouseHidden','lastFramesPerSecond','scene','all','layer','2248AnBISY','rawRenderState','push','particlesTextures','ellipsoid','toRadians','particles','pixelSize','ColorRamp','RED','SCENE3D','lat','#ffffff','context','mouseMove','random','mode','flatMap','worker','number','flipY','mouse_move','max','textures','createCommand','isDestroyed','createWindTextures','bounds','alt','RGBA','style','11218120UYHnUq','createRenderingTextures','data','atan2','postProcessingPosition','preExecute','getSegmentDrawVertexShader','fromGeometry','_onMouseMoveEvent','maxAge','_randomParticle','windTextures','color','_updateIng','CanvasWindLayer','none','clientHeight','east','removeEventListener','_onMouseUpEvent','destroy','createPrimitives','visibility','STATIC_DRAW','71rhRqvn','geometry','off','framebuffer','drawingBufferHeight','visible','windData','grid','Cartesian3','create','show','4kZNJlK','latRange','attributeLocations','height','floor','camera','commandToExecute','lonRange','currentParticlesPosition','createRenderingFramebuffers','_canvasParticles','frameRateAdjustment','_createCanvas','getSegmentDrawFragmentShader','Unknown\x20command\x20type','globalCompositeOperation','shaderProgram','OPAQUE','lineTo','segments','requestRender','ymin','mouseUp','11FDrZgi','hidden','25231020JZwbSk','viewerParameters','3244722igLHKc','createParticlesTextures','_calc_speedRate','EllipsoidalOccluder','5643bmjQtT','longitude','_pointerEvents','clientWidth','updateViewerParameters','min\x20is\x20undefined,\x20calculate\x20min','lineWidth','xmax','pointer-events','array','changed','south','cartesianToCartographic','MAX_VALUE','outputTexture','dynamic','cols','lng','_map','postMessage','calculateSpeed','WindUtil','Cesium','colors','redraw','stringify','getPostProcessingPositionShader','fragmentShaderSource','nextParticlesPosition','_tomap','tlng','onParticlesTextureSizeChange','ymax','position','zIndex','toDegrees','lineLength','Draw','segmentsDepth','destroyParticlesTextures','266mgJtst','fixedHeight','setOptions','pickEllipsoid','vmin','rows','getUVByXY','canvas','onColorTableChange','length','defineProperty','particlesTextureSize','CLAMP_TO_EDGE','setDate','clearFramebuffers','getParticles','pointerEvents','_removedHook','slice','#version\x20300\x20es\x0a\x0a//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec2\x20uRange;\x20//\x20(min,\x20max)\x0auniform\x20vec2\x20vRange;\x20//\x20(min,\x20max)\x0auniform\x20vec2\x20speedRange;\x20//\x20(min,\x20max)\x0auniform\x20vec2\x20dimension;\x20//\x20(lon,\x20lat)\x0auniform\x20vec2\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec2\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0a\x0auniform\x20float\x20speedScaleFactor;\x0auniform\x20float\x20frameRateAdjustment;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20getInterval(vec2\x20maximum,\x20vec2\x20minimum,\x20vec2\x20dimension)\x20{\x0a\x20\x20return\x20(maximum\x20-\x20minimum)\x20/\x20(dimension\x20-\x201.0f);\x0a}\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec2\x20lonLat)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20lonLat.x\x20=\x20clamp(lonLat.x,\x20minimum.x,\x20maximum.x);\x0a\x20\x20lonLat.y\x20=\x20clamp(lonLat.y,\x20minimum.y,\x20maximum.y);\x0a\x0a\x20\x20vec2\x20interval\x20=\x20getInterval(maximum,\x20minimum,\x20dimension);\x0a\x0a\x20\x20vec2\x20index2D\x20=\x20vec2(0.0f);\x0a\x20\x20index2D.x\x20=\x20(lonLat.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20index2D.y\x20=\x20(lonLat.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x0a\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20dimension.y);\x0a\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWindComponent(sampler2D\x20componentTexture,\x20vec2\x20lonLat)\x20{\x0a\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLat);\x0a\x20\x20float\x20result\x20=\x20texture(componentTexture,\x20normalizedIndex2D).r;\x0a\x20\x20return\x20result;\x0a}\x0a\x0avec2\x20getWindComponents(vec2\x20lonLat)\x20{\x0a\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLat);\x0a\x20\x20float\x20u\x20=\x20texture(U,\x20normalizedIndex2D).r;\x0a\x20\x20float\x20v\x20=\x20texture(V,\x20normalizedIndex2D).r;\x0a\x20\x20return\x20vec2(u,\x20v);\x0a}\x0a\x0avec2\x20bilinearInterpolation(vec2\x20lonLat)\x20{\x0a\x20\x20float\x20lon\x20=\x20lonLat.x;\x0a\x20\x20float\x20lat\x20=\x20lonLat.y;\x0a\x0a\x20\x20vec2\x20interval\x20=\x20getInterval(maximum,\x20minimum,\x20dimension);\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20grid\x20cell\x20coordinates\x0a\x20\x20float\x20lon0\x20=\x20floor(lon\x20/\x20interval.x)\x20*\x20interval.x;\x0a\x20\x20float\x20lon1\x20=\x20lon0\x20+\x20interval.x;\x0a\x20\x20float\x20lat0\x20=\x20floor(lat\x20/\x20interval.y)\x20*\x20interval.y;\x0a\x20\x20float\x20lat1\x20=\x20lat0\x20+\x20interval.y;\x0a\x0a\x20\x20\x20\x20//\x20Get\x20wind\x20vectors\x20at\x20four\x20corners\x0a\x20\x20vec2\x20v00\x20=\x20getWindComponents(vec2(lon0,\x20lat0));\x0a\x20\x20vec2\x20v10\x20=\x20getWindComponents(vec2(lon1,\x20lat0));\x0a\x20\x20vec2\x20v01\x20=\x20getWindComponents(vec2(lon0,\x20lat1));\x0a\x20\x20vec2\x20v11\x20=\x20getWindComponents(vec2(lon1,\x20lat1));\x0a\x0a\x20\x20\x20\x20//\x20Check\x20if\x20all\x20wind\x20vectors\x20are\x20zero\x0a\x20\x20if(length(v00)\x20==\x200.0f\x20&&\x20length(v10)\x20==\x200.0f\x20&&\x20length(v01)\x20==\x200.0f\x20&&\x20length(v11)\x20==\x200.0f)\x20{\x0a\x20\x20\x20\x20return\x20vec2(0.0f,\x200.0f);\x0a\x20\x20}\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20interpolation\x20weights\x0a\x20\x20float\x20s\x20=\x20(lon\x20-\x20lon0)\x20/\x20interval.x;\x0a\x20\x20float\x20t\x20=\x20(lat\x20-\x20lat0)\x20/\x20interval.y;\x0a\x0a\x20\x20\x20\x20//\x20Perform\x20bilinear\x20interpolation\x20on\x20vector\x20components\x0a\x20\x20vec2\x20v0\x20=\x20mix(v00,\x20v10,\x20s);\x0a\x20\x20vec2\x20v1\x20=\x20mix(v01,\x20v11,\x20s);\x0a\x20\x20return\x20mix(v0,\x20v1,\x20t);\x0a}\x0a\x0avec2\x20lengthOfLonLat(vec2\x20lonLat)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20float\x20latitude\x20=\x20radians(lonLat.y);\x0a\x0a\x20\x20float\x20term1\x20=\x20111132.92f;\x0a\x20\x20float\x20term2\x20=\x20559.82f\x20*\x20cos(2.0f\x20*\x20latitude);\x0a\x20\x20float\x20term3\x20=\x201.175f\x20*\x20cos(4.0f\x20*\x20latitude);\x0a\x20\x20float\x20term4\x20=\x200.0023f\x20*\x20cos(6.0f\x20*\x20latitude);\x0a\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20float\x20term5\x20=\x20111412.84f\x20*\x20cos(latitude);\x0a\x20\x20float\x20term6\x20=\x2093.5f\x20*\x20cos(3.0f\x20*\x20latitude);\x0a\x20\x20float\x20term7\x20=\x200.118f\x20*\x20cos(5.0f\x20*\x20latitude);\x0a\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avec2\x20convertSpeedUnitToLonLat(vec2\x20lonLat,\x20vec2\x20speed)\x20{\x0a\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLat);\x0a\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20vec2\x20windVectorInLonLat\x20=\x20vec2(u,\x20v);\x0a\x0a\x20\x20return\x20windVectorInLonLat;\x0a}\x0a\x0avec2\x20calculateSpeedByRungeKutta2(vec2\x20lonLat)\x20{\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods#Second-order_methods_with_two_stages\x20for\x20detail\x0a\x20\x20const\x20float\x20h\x20=\x200.5f;\x0a\x0a\x20\x20vec2\x20y_n\x20=\x20lonLat;\x0a\x20\x20vec2\x20f_n\x20=\x20bilinearInterpolation(lonLat);\x0a\x20\x20vec2\x20midpoint\x20=\x20y_n\x20+\x200.5f\x20*\x20h\x20*\x20convertSpeedUnitToLonLat(y_n,\x20f_n)\x20*\x20speedScaleFactor;\x0a\x20\x20vec2\x20speed\x20=\x20h\x20*\x20bilinearInterpolation(midpoint)\x20*\x20speedScaleFactor;\x0a\x0a\x20\x20return\x20speed;\x0a}\x0a\x0avec2\x20calculateWindNorm(vec2\x20speed)\x20{\x0a\x20\x20float\x20speedLength\x20=\x20length(speed.xy);\x0a\x20\x20if(speedLength\x20==\x200.0f)\x20{\x0a\x20\x20\x20\x20return\x20vec2(0.0f);\x0a\x20\x20}\x0a\x0a\x20\x20\x20\x20//\x20Clamp\x20speedLength\x20to\x20range\x0a\x20\x20float\x20clampedSpeed\x20=\x20clamp(speedLength,\x20speedRange.x,\x20speedRange.y);\x0a\x20\x20float\x20normalizedSpeed\x20=\x20(clampedSpeed\x20-\x20speedRange.x)\x20/\x20(speedRange.y\x20-\x20speedRange.x);\x0a\x20\x20return\x20vec2(speedLength,\x20normalizedSpeed);\x0a}\x0a\x0aout\x20vec4\x20fragColor;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20vec2\x20lonLat\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rg;\x0a\x20\x20vec2\x20speedOrigin\x20=\x20bilinearInterpolation(lonLat);\x0a\x20\x20vec2\x20speed\x20=\x20calculateSpeedByRungeKutta2(lonLat)\x20*\x20frameRateAdjustment;\x0a\x20\x20vec2\x20speedInLonLat\x20=\x20convertSpeedUnitToLonLat(lonLat,\x20speed);\x0a\x0a\x20\x20fragColor\x20=\x20vec4(speedInLonLat,\x20calculateWindNorm(speedOrigin));\x0a}\x0a'];_0x487c=function(){return _0x5dc0fe;};return _0x487c();}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection},updatePositionShader='#version\x20300\x20es\x0aprecision\x20highp\x20float;\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20particlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0aout\x20vec4\x20fragColor;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20获取当前粒子的位置\x0a\x20\x20vec2\x20currentPos\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rg;\x0a\x20\x20\x20\x20//\x20获取粒子的速度\x0a\x20\x20vec2\x20speed\x20=\x20texture(particlesSpeed,\x20v_textureCoordinates).rg;\x0a\x20\x20\x20\x20//\x20计算下一个位置\x0a\x20\x20vec2\x20nextPos\x20=\x20currentPos\x20+\x20speed;\x0a\x0a\x20\x20\x20\x20//\x20将新的位置写入\x20fragColor\x0a\x20\x20fragColor\x20=\x20vec4(nextPos,\x200.0f,\x201.0f);\x0a}\x0a',calculateSpeedShader=_0x676d52(0x204),postProcessingPositionFragmentShader='#version\x20300\x20es\x0aprecision\x20highp\x20float;\x0a\x0auniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20particlesSpeed;\x20//\x20(u,\x20v,\x20norm)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20dataLonRange;\x0auniform\x20vec2\x20dataLatRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x0auniform\x20float\x20dropRate;\x0auniform\x20float\x20dropRateBump;\x0a\x0a//\x20添加新的\x20uniform\x20变量\x0auniform\x20bool\x20useViewerBounds;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898f,\x2078.233f,\x204375.85453f);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0f,\x201.0f);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec2\x20generateRandomParticle(vec2\x20seed)\x20{\x0a\x20\x20vec2\x20range;\x0a\x20\x20float\x20randomLon,\x20randomLat;\x0a\x0a\x20\x20if(useViewerBounds)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20//\x20在当前视域范围内生成粒子\x0a\x20\x20\x20\x20randomLon\x20=\x20rand(seed,\x20lonRange);\x0a\x20\x20\x20\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20//\x20在数据范围内生成粒子\x0a\x20\x20\x20\x20randomLon\x20=\x20rand(seed,\x20dataLonRange);\x0a\x20\x20\x20\x20randomLat\x20=\x20rand(-seed,\x20dataLatRange);\x0a\x20\x20}\x0a\x0a\x20\x20return\x20vec2(randomLon,\x20randomLat);\x0a}\x0a\x0abool\x20particleOutbound(vec2\x20particle)\x20{\x0a\x20\x20return\x20particle.y\x20<\x20dataLatRange.x\x20||\x20particle.y\x20>\x20dataLatRange.y\x20||\x20particle.x\x20<\x20dataLonRange.x\x20||\x20particle.x\x20>\x20dataLonRange.y;\x0a}\x0a\x0aout\x20vec4\x20fragColor;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20vec2\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rg;\x0a\x20\x20vec4\x20nextSpeed\x20=\x20texture(particlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20float\x20speedNorm\x20=\x20nextSpeed.a;\x0a\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20speedNorm;\x0a\x0a\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20vec2\x20seed2\x20=\x20nextSpeed.rg\x20+\x20v_textureCoordinates;\x0a\x20\x20vec2\x20randomParticle\x20=\x20generateRandomParticle(seed1);\x0a\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20if(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20fragColor\x20=\x20vec4(randomParticle,\x200.0f,\x201.0f);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20fragColor\x20=\x20vec4(nextParticle,\x200.0f,\x200.0f);\x0a\x20\x20}\x0a}\x0a',renderParticlesFragmentShader='#version\x20300\x20es\x0aprecision\x20highp\x20float;\x0a\x0ain\x20vec4\x20speed;\x0ain\x20float\x20v_segmentPosition;\x0ain\x20vec2\x20textureCoordinate;\x0a\x0auniform\x20vec2\x20domain;\x0auniform\x20vec2\x20displayRange;\x0auniform\x20sampler2D\x20colorTable;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0aout\x20vec4\x20fragColor;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20const\x20float\x20zero\x20=\x200.0f;\x0a\x20\x20if(speed.a\x20>\x20zero\x20&&\x20speed.b\x20>\x20displayRange.x\x20&&\x20speed.b\x20<\x20displayRange.y)\x20{\x0a\x20\x20\x20\x20float\x20speedLength\x20=\x20clamp(speed.b,\x20domain.x,\x20domain.y);\x0a\x20\x20\x20\x20float\x20normalizedSpeed\x20=\x20(speedLength\x20-\x20domain.x)\x20/\x20(domain.y\x20-\x20domain.x);\x0a\x20\x20\x20\x20vec4\x20baseColor\x20=\x20texture(colorTable,\x20vec2(normalizedSpeed,\x20zero));\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20//\x20使用更平滑的渐变效果\x0a\x20\x20\x20\x20float\x20alpha\x20=\x20smoothstep(0.0f,\x201.0f,\x20v_segmentPosition);\x0a\x20\x20\x20\x20alpha\x20=\x20pow(alpha,\x201.5f);\x20//\x20调整透明度渐变曲线\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20//\x20根据速度调整透明度\x0a\x20\x20\x20\x20float\x20speedAlpha\x20=\x20mix(0.3f,\x201.0f,\x20speed.a);\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20//\x20组合颜色和透明度\x0a\x20\x20\x20\x20fragColor\x20=\x20vec4(baseColor.rgb,\x20baseColor.a\x20*\x20alpha\x20*\x20speedAlpha);\x0a\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20fragColor\x20=\x20vec4(zero);\x0a\x20\x20}\x0a\x0a\x20\x20float\x20segmentsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x20\x20if(segmentsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20fragColor\x20=\x20vec4(zero);\x0a\x20\x20}\x0a}\x0a',renderParticlesVertexShader='#version\x20300\x20es\x0aprecision\x20highp\x20float;\x0a\x0ain\x20vec2\x20st;\x0ain\x20vec3\x20normal;\x0a\x0auniform\x20sampler2D\x20previousParticlesPosition;\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20particlesSpeed;\x0a\x0auniform\x20float\x20frameRateAdjustment;\x0auniform\x20float\x20particleHeight;\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20vec2\x20lineWidth;\x0auniform\x20vec2\x20lineLength;\x0auniform\x20vec2\x20domain;\x0auniform\x20bool\x20is3D;\x0a\x0a//\x20添加输出变量传递给片元着色器\x0aout\x20vec4\x20speed;\x0aout\x20float\x20v_segmentPosition;\x0aout\x20vec2\x20textureCoordinate;\x0a\x0a//\x20添加结构体定义\x0astruct\x20adjacentPoints\x20{\x0a\x20\x20vec4\x20previous;\x0a\x20\x20vec4\x20current;\x0a\x20\x20vec4\x20next;\x0a};\x0a\x0avec3\x20convertCoordinate(vec2\x20lonLat)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20read\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20float\x20a\x20=\x206378137.0f;\x20//\x20Semi-major\x20axis\x0a\x20\x20float\x20b\x20=\x206356752.3142f;\x20//\x20Semi-minor\x20axis\x0a\x20\x20float\x20e2\x20=\x206.69437999014e-3f;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20float\x20latitude\x20=\x20radians(lonLat.y);\x0a\x20\x20float\x20longitude\x20=\x20radians(lonLat.x);\x0a\x0a\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0f\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0f);\x0a\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calculateProjectedCoordinate(vec2\x20lonLat)\x20{\x0a\x20\x20if(is3D)\x20{\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLat);\x0a\x20\x20\x20\x20\x20\x20\x20\x20//\x20使用\x20modelViewProjection\x20矩阵进行投影变换\x0a\x20\x20\x20\x20vec4\x20projectedPosition\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0f);\x0a\x20\x20\x20\x20return\x20projectedPosition;\x0a\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20vec3\x20position2D\x20=\x20vec3(radians(lonLat.x),\x20radians(lonLat.y),\x200.0f);\x0a\x20\x20\x20\x20return\x20czm_modelViewProjection\x20*\x20vec4(position2D,\x201.0f);\x0a\x20\x20}\x0a}\x0a\x0avec4\x20calculateOffsetOnNormalDirection(vec4\x20pointA,\x20vec4\x20pointB,\x20float\x20offsetSign,\x20float\x20widthFactor)\x20{\x0a\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0f);\x0a\x20\x20vec2\x20pointA_XY\x20=\x20(pointA.xy\x20/\x20pointA.w)\x20*\x20aspectVec2;\x0a\x20\x20vec2\x20pointB_XY\x20=\x20(pointB.xy\x20/\x20pointB.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20//\x20计算方向向量\x0a\x20\x20vec2\x20direction\x20=\x20normalize(pointB_XY\x20-\x20pointA_XY);\x0a\x0a\x20\x20\x20\x20//\x20计算法向量\x0a\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x0a\x20\x20\x20\x20//\x20使用\x20widthFactor\x20调整宽度\x0a\x20\x20float\x20offsetLength\x20=\x20widthFactor\x20*\x20lineWidth.y;\x0a\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0f,\x200.0f);\x0a\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20翻转\x20Y\x20轴坐标\x0a\x20\x20vec2\x20flippedIndex\x20=\x20vec2(st.x,\x201.0f\x20-\x20st.y);\x0a\x0a\x20\x20vec2\x20particleIndex\x20=\x20flippedIndex;\x0a\x20\x20speed\x20=\x20texture(particlesSpeed,\x20particleIndex);\x0a\x0a\x20\x20vec2\x20previousPosition\x20=\x20texture(previousParticlesPosition,\x20particleIndex).rg;\x0a\x20\x20vec2\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rg;\x0a\x20\x20vec2\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex).rg;\x0a\x0a\x20\x20float\x20isAnyRandomPointUsed\x20=\x20texture(postProcessingPosition,\x20particleIndex).a\x20+\x0a\x20\x20\x20\x20texture(currentParticlesPosition,\x20particleIndex).a\x20+\x0a\x20\x20\x20\x20texture(previousParticlesPosition,\x20particleIndex).a;\x0a\x0a\x20\x20adjacentPoints\x20projectedCoordinates;\x0a\x20\x20if(isAnyRandomPointUsed\x20>\x200.0f)\x20{\x0a\x20\x20\x20\x20projectedCoordinates.previous\x20=\x20calculateProjectedCoordinate(previousPosition);\x0a\x20\x20\x20\x20projectedCoordinates.current\x20=\x20projectedCoordinates.previous;\x0a\x20\x20\x20\x20projectedCoordinates.next\x20=\x20projectedCoordinates.previous;\x0a\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20projectedCoordinates.previous\x20=\x20calculateProjectedCoordinate(previousPosition);\x0a\x20\x20\x20\x20projectedCoordinates.current\x20=\x20calculateProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20projectedCoordinates.next\x20=\x20calculateProjectedCoordinate(nextPosition);\x0a\x20\x20}\x0a\x0a\x20\x20int\x20pointToUse\x20=\x20int(normal.x);\x0a\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x20\x20vec4\x20offset\x20=\x20vec4(0.0f);\x0a\x0a\x20\x20\x20\x20//\x20计算速度相关的宽度和长度因子\x0a\x20\x20float\x20speedLength\x20=\x20clamp(speed.b,\x20domain.x,\x20domain.y);\x0a\x20\x20float\x20normalizedSpeed\x20=\x20(speedLength\x20-\x20domain.x)\x20/\x20(domain.y\x20-\x20domain.x);\x0a\x0a\x20\x20\x20\x20//\x20根据速度计算宽度\x0a\x20\x20float\x20widthFactor\x20=\x20mix(lineWidth.x,\x20lineWidth.y,\x20normalizedSpeed);\x0a\x20\x20widthFactor\x20*=\x20(pointToUse\x20<\x200\x20?\x201.0f\x20:\x200.5f);\x20//\x20头部更宽，尾部更窄\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20length\x20based\x20on\x20speed\x0a\x20\x20float\x20lengthFactor\x20=\x20mix(lineLength.x,\x20lineLength.y,\x20normalizedSpeed)\x20*\x20pixelSize;\x0a\x0a\x20\x20if(pointToUse\x20==\x201)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20//\x20头部位置\x0a\x20\x20\x20\x20offset\x20=\x20pixelSize\x20*\x20calculateOffsetOnNormalDirection(projectedCoordinates.previous,\x20projectedCoordinates.current,\x20offsetSign,\x20widthFactor);\x0a\x20\x20\x20\x20gl_Position\x20=\x20projectedCoordinates.previous\x20+\x20offset;\x0a\x20\x20\x20\x20v_segmentPosition\x20=\x200.0f;\x20//\x20头部\x0a\x20\x20}\x20else\x20if(pointToUse\x20==\x20-1)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20//\x20Get\x20direction\x20and\x20normalize\x20it\x20to\x20length\x201.0\x0a\x20\x20\x20\x20vec4\x20direction\x20=\x20normalize(projectedCoordinates.next\x20-\x20projectedCoordinates.current);\x0a\x20\x20\x20\x20vec4\x20extendedPosition\x20=\x20projectedCoordinates.current\x20+\x20direction\x20*\x20lengthFactor;\x0a\x0a\x20\x20\x20\x20offset\x20=\x20pixelSize\x20*\x20calculateOffsetOnNormalDirection(projectedCoordinates.current,\x20extendedPosition,\x20offsetSign,\x20widthFactor);\x0a\x20\x20\x20\x20gl_Position\x20=\x20extendedPosition\x20+\x20offset;\x0a\x20\x20\x20\x20v_segmentPosition\x20=\x201.0f;\x20//\x20尾部\x0a\x20\x20}\x0a\x0a\x20\x20textureCoordinate\x20=\x20st;\x0a}\x0a';const {ShaderSource:ShaderSource$1}=mars3d__namespace[_0x676d52(0x1df)];class ShaderManager{static['getCalculateSpeedShader'](){return new ShaderSource$1({'sources':[calculateSpeedShader]});}static['getUpdatePositionShader'](){return new ShaderSource$1({'sources':[updatePositionShader]});}static['getSegmentDrawVertexShader'](){return new ShaderSource$1({'sources':[renderParticlesVertexShader]});}static[_0x676d52(0x1b7)](){return new ShaderSource$1({'sources':[renderParticlesFragmentShader]});}static['getPostProcessingPositionShader'](){return new ShaderSource$1({'sources':[postProcessingPositionFragmentShader]});}}const {BufferUsage:BufferUsage$1,ClearCommand:ClearCommand$1,Color:Color$2,ComputeCommand,DrawCommand,Geometry:Geometry$1,Matrix4,Pass:Pass$1,PrimitiveType:PrimitiveType$1,RenderState,ShaderProgram,ShaderSource,VertexArray:VertexArray$1,defaultValue,defined,destroyObject}=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x2a48b0){const _0x47fa3f=_0x676d52;this['commandType']=_0x2a48b0['commandType'],this['geometry']=_0x2a48b0['geometry'],this[_0x47fa3f(0x1ac)]=_0x2a48b0['attributeLocations'],this['primitiveType']=_0x2a48b0['primitiveType'],this['uniformMap']=_0x2a48b0['uniformMap']||{},this['vertexShaderSource']=_0x2a48b0['vertexShaderSource'],this[_0x47fa3f(0x1e4)]=_0x2a48b0[_0x47fa3f(0x1e4)],this['rawRenderState']=_0x2a48b0[_0x47fa3f(0x169)],this[_0x47fa3f(0x1a2)]=_0x2a48b0['framebuffer'],this[_0x47fa3f(0x1d7)]=_0x2a48b0['outputTexture'],this['autoClear']=defaultValue(_0x2a48b0['autoClear'],![]),this['preExecute']=_0x2a48b0['preExecute'],this['show']=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this['isDynamic']=_0x2a48b0['isDynamic']??(()=>!![]),this['autoClear']&&(this[_0x47fa3f(0x14d)]=new ClearCommand$1({'color':new Color$2(0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Pass$1[_0x47fa3f(0x1bb)]}));}['createCommand'](_0x5f49e8){const _0x16f30f=_0x676d52;if(this[_0x16f30f(0x218)]===_0x16f30f(0x1ee)){const _0x37db75=VertexArray$1[_0x16f30f(0x18e)]({'context':_0x5f49e8,'geometry':this[_0x16f30f(0x1a0)],'attributeLocations':this[_0x16f30f(0x1ac)],'bufferUsage':BufferUsage$1['STATIC_DRAW']}),_0x6e1b39=ShaderProgram[_0x16f30f(0x20b)]({'context':_0x5f49e8,'vertexShaderSource':this[_0x16f30f(0x150)],'fragmentShaderSource':this['fragmentShaderSource'],'attributeLocations':this['attributeLocations']}),_0x2a3c68=RenderState[_0x16f30f(0x20b)](this[_0x16f30f(0x169)]);return new DrawCommand({'owner':this,'vertexArray':_0x37db75,'primitiveType':this['primitiveType'],'modelMatrix':Matrix4['IDENTITY'],'renderState':_0x2a3c68,'shaderProgram':_0x6e1b39,'framebuffer':this['framebuffer'],'uniformMap':this['uniformMap'],'pass':Pass$1['OPAQUE']});}else{if(this['commandType']==='Compute')return new ComputeCommand({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this[_0x16f30f(0x209)],'outputTexture':this['outputTexture'],'persists':!![]});else throw new Error(_0x16f30f(0x1b8));}}['setGeometry'](_0x229b4a,_0x2667cd){const _0x5f162a=_0x676d52;this['geometry']=_0x2667cd,defined(this[_0x5f162a(0x1b0)])&&(this['commandToExecute']['vertexArray']=VertexArray$1['fromGeometry']({'context':_0x229b4a,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':BufferUsage$1['STATIC_DRAW']}));}['update'](_0x48d693){const _0x46e415=_0x676d52;if(!this['isDynamic']())return;if(!this[_0x46e415(0x1a9)]||!defined(_0x48d693))return;!defined(this[_0x46e415(0x1b0)])&&(this['commandToExecute']=this[_0x46e415(0x180)](_0x48d693['context']));defined(this[_0x46e415(0x18c)])&&this['preExecute']();if(!_0x48d693['commandList']){console[_0x46e415(0x161)]('frameState.commandList\x20is\x20undefined');return;}defined(this['clearCommand'])&&_0x48d693[_0x46e415(0x154)][_0x46e415(0x16a)](this[_0x46e415(0x14d)]),defined(this['commandToExecute'])&&_0x48d693[_0x46e415(0x154)]['push'](this['commandToExecute']);}[_0x676d52(0x181)](){return![];}['destroy'](){const _0x2e329e=_0x676d52;if(defined(this['commandToExecute'])){var _0xb6e4dc;(_0xb6e4dc=this['commandToExecute']['shaderProgram'])===null||_0xb6e4dc===void 0x0||_0xb6e4dc[_0x2e329e(0x19b)](),this['commandToExecute'][_0x2e329e(0x1ba)]=undefined;}return destroyObject(this);}}function deepMerge(_0x148911,_0x5812f0){const _0x125650=_0x676d52;if(!_0x148911)return _0x5812f0;if(!_0x5812f0)return _0x148911;const _0x4c6b58={..._0x5812f0};for(const _0x43d7ff in _0x148911){if(Object['prototype']['hasOwnProperty']['call'](_0x148911,_0x43d7ff)){const _0x35fc8c=_0x148911[_0x43d7ff],_0x47493b=_0x5812f0[_0x43d7ff];if(Array['isArray'](_0x35fc8c)){_0x4c6b58[_0x43d7ff]=_0x35fc8c[_0x125650(0x203)]();continue;}if(_0x35fc8c&&typeof _0x35fc8c==='object'){_0x4c6b58[_0x43d7ff]=deepMerge(_0x35fc8c,_0x47493b||{});continue;}_0x35fc8c!==undefined&&(_0x4c6b58[_0x43d7ff]=_0x35fc8c);}}return _0x4c6b58;}const {Cartesian2:Cartesian2$1,FrameRateMonitor,PixelDatatype:PixelDatatype$1,PixelFormat:PixelFormat$1,Sampler:Sampler$1,Texture:Texture$1,TextureMagnificationFilter:TextureMagnificationFilter$1,TextureMinificationFilter:TextureMinificationFilter$1}=mars3d__namespace['Cesium'];class WindParticlesComputing{constructor(_0x42bd40,_0x3f717a,_0x47d1f6,_0x1972c2,_0x13bce8){const _0x248870=_0x676d52;this[_0x248870(0x175)]=_0x42bd40,this['options']=_0x47d1f6,this[_0x248870(0x1c4)]=_0x1972c2,this[_0x248870(0x1a5)]=_0x3f717a,this[_0x248870(0x159)]=0x3c,this['frameRateAdjustment']=0x1,this['frameRateMonitor']=new FrameRateMonitor({'scene':_0x13bce8,'samplingWindow':0x1,'quietPeriod':0x0}),this['initFrameRate'](),this['createWindTextures'](),this['createParticlesTextures'](),this['createComputingPrimitives']();}[_0x676d52(0x21a)](){const _0x48f008=()=>{const _0x186d04=_0x4546;this[_0x186d04(0x20d)][_0x186d04(0x164)]>0x14&&(this[_0x186d04(0x159)]=this['frameRateMonitor']['lastFramesPerSecond'],this[_0x186d04(0x1b5)]=0x3c/Math['max'](this[_0x186d04(0x159)],0x1));};_0x48f008();const _0x294649=setInterval(_0x48f008,0x3e8),_0x186609=this['destroy']['bind'](this);this['destroy']=()=>{clearInterval(_0x294649),_0x186609();};}[_0x676d52(0x182)](){const _0x5493dd=_0x676d52,_0x41db58={'context':this['context'],'width':this['windData']['width'],'height':this['windData']['height'],'pixelFormat':PixelFormat$1[_0x5493dd(0x171)],'pixelDatatype':PixelDatatype$1['FLOAT'],'flipY':this[_0x5493dd(0x20c)]['flipY']??![],'sampler':new Sampler$1({'minificationFilter':TextureMinificationFilter$1['LINEAR'],'magnificationFilter':TextureMagnificationFilter$1['LINEAR']})};this[_0x5493dd(0x192)]={'U':new Texture$1({..._0x41db58,'source':{'arrayBufferView':new Float32Array(this['windData']['u'][_0x5493dd(0x1d2)])}}),'V':new Texture$1({..._0x41db58,'source':{'arrayBufferView':new Float32Array(this['windData']['v']['array'])}})};}[_0x676d52(0x1c6)](){const _0x481e13=_0x676d52,_0x59ab35={'context':this['context'],'width':this['options'][_0x481e13(0x1fc)],'height':this[_0x481e13(0x20c)][_0x481e13(0x1fc)],'pixelFormat':PixelFormat$1['RGBA'],'pixelDatatype':PixelDatatype$1['FLOAT'],'flipY':![],'source':{'arrayBufferView':new Float32Array(this['options']['particlesTextureSize']*this['options'][_0x481e13(0x1fc)]*0x4)['fill'](0x0)},'sampler':new Sampler$1({'minificationFilter':TextureMinificationFilter$1['NEAREST'],'magnificationFilter':TextureMagnificationFilter$1['NEAREST']})};this[_0x481e13(0x16b)]={'previousParticlesPosition':new Texture$1(_0x59ab35),'currentParticlesPosition':new Texture$1(_0x59ab35),'nextParticlesPosition':new Texture$1(_0x59ab35),'postProcessingPosition':new Texture$1(_0x59ab35),'particlesSpeed':new Texture$1(_0x59ab35)};}[_0x676d52(0x1f0)](){const _0x44a065=_0x676d52;Object['values'](this['particlesTextures'])[_0x44a065(0x207)](_0x31eeb8=>_0x31eeb8['destroy']());}[_0x676d52(0x15f)](){const _0x2ec897=_0x676d52;this[_0x2ec897(0x15c)]={'calculateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':()=>this['windTextures']['U'],'V':()=>this[_0x2ec897(0x192)]['V'],'uRange':()=>new Cartesian2$1(this['windData']['u']['min'],this['windData']['u'][_0x2ec897(0x17e)]),'vRange':()=>new Cartesian2$1(this['windData']['v']['min'],this['windData']['v']['max']),'speedRange':()=>new Cartesian2$1(this[_0x2ec897(0x1a5)]['speed']['min'],this['windData']['speed']['max']),'currentParticlesPosition':()=>this['particlesTextures']['currentParticlesPosition'],'speedScaleFactor':()=>{const _0x2fb495=_0x2ec897;return(this[_0x2fb495(0x1c4)]['pixelSize']+0x32)*this['options']['speedFactor'];},'frameRateAdjustment':()=>this['frameRateAdjustment'],'dimension':()=>new Cartesian2$1(this['windData'][_0x2ec897(0x144)],this['windData']['height']),'minimum':()=>new Cartesian2$1(this['windData'][_0x2ec897(0x183)]['west'],this[_0x2ec897(0x1a5)]['bounds'][_0x2ec897(0x1d4)]),'maximum':()=>new Cartesian2$1(this[_0x2ec897(0x1a5)]['bounds'][_0x2ec897(0x198)],this['windData']['bounds']['north'])},'fragmentShaderSource':ShaderManager['getCalculateSpeedShader'](),'outputTexture':this['particlesTextures'][_0x2ec897(0x152)],'preExecute':()=>{const _0xaaacf6=_0x2ec897,_0x249a01=this[_0xaaacf6(0x16b)]['previousParticlesPosition'];this['particlesTextures']['previousParticlesPosition']=this[_0xaaacf6(0x16b)][_0xaaacf6(0x1b2)],this['particlesTextures'][_0xaaacf6(0x1b2)]=this['particlesTextures']['postProcessingPosition'],this['particlesTextures']['postProcessingPosition']=_0x249a01,this[_0xaaacf6(0x15c)][_0xaaacf6(0x1dd)]['commandToExecute']&&(this['primitives'][_0xaaacf6(0x1dd)]['commandToExecute']['outputTexture']=this['particlesTextures']['particlesSpeed']);},'isDynamic':()=>this[_0x2ec897(0x20c)]['dynamic']}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':()=>this['particlesTextures'][_0x2ec897(0x1b2)],'particlesSpeed':()=>this[_0x2ec897(0x16b)]['particlesSpeed']},'fragmentShaderSource':ShaderManager['getUpdatePositionShader'](),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':()=>{const _0x5b469d=_0x2ec897;this['primitives'][_0x5b469d(0x153)]['commandToExecute']&&(this['primitives']['updatePosition'][_0x5b469d(0x1b0)]['outputTexture']=this['particlesTextures'][_0x5b469d(0x1e5)]);},'isDynamic':()=>this['options'][_0x2ec897(0x1d8)]}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':()=>this['particlesTextures'][_0x2ec897(0x1e5)],'particlesSpeed':()=>this[_0x2ec897(0x16b)][_0x2ec897(0x152)],'lonRange':()=>this['viewerParameters']['lonRange'],'latRange':()=>this[_0x2ec897(0x1c4)]['latRange'],'dataLonRange':()=>new Cartesian2$1(this['windData']['bounds'][_0x2ec897(0x158)],this['windData'][_0x2ec897(0x183)]['east']),'dataLatRange':()=>new Cartesian2$1(this['windData']['bounds']['south'],this['windData']['bounds']['north']),'randomCoefficient':function(){return Math['random']();},'dropRate':()=>this[_0x2ec897(0x20c)]['dropRate'],'dropRateBump':()=>this['options']['dropRateBump'],'useViewerBounds':()=>this[_0x2ec897(0x20c)]['useViewerBounds']},'fragmentShaderSource':ShaderManager[_0x2ec897(0x1e3)](),'outputTexture':this[_0x2ec897(0x16b)]['postProcessingPosition'],'preExecute':()=>{const _0x102cf7=_0x2ec897;this[_0x102cf7(0x15c)]['postProcessingPosition'][_0x102cf7(0x1b0)]&&(this['primitives']['postProcessingPosition']['commandToExecute'][_0x102cf7(0x1d7)]=this['particlesTextures']['postProcessingPosition']);},'isDynamic':()=>this[_0x2ec897(0x20c)]['dynamic']})};}['reCreateWindTextures'](){this['windTextures']['U']['destroy'](),this['windTextures']['V']['destroy'](),this['createWindTextures']();}['updateWindData'](_0x224e07){this['windData']=_0x224e07,this['reCreateWindTextures']();}['updateOptions'](_0x50c724){const _0x23bfd5=_0x50c724['flipY']!==undefined&&_0x50c724['flipY']!==this['options']['flipY'];this['options']=deepMerge(_0x50c724,this['options']),_0x23bfd5&&this['reCreateWindTextures']();}[_0x676d52(0x21d)](_0x201a8f){const _0x36bd63=_0x676d52,{array:_0x5e00ae}=_0x201a8f;let {min:_0xe1bc82,max:_0x373875}=_0x201a8f;const _0x1a471e=new Float32Array(_0x5e00ae['length']);_0xe1bc82===undefined&&(console['warn'](_0x36bd63(0x1ce)),_0xe1bc82=Math[_0x36bd63(0x15e)](..._0x5e00ae));_0x373875===undefined&&(console['warn']('max\x20is\x20undefined,\x20calculate\x20max'),_0x373875=Math['max'](..._0x5e00ae));const _0x343bd9=Math['max'](Math['abs'](_0xe1bc82),Math['abs'](_0x373875));for(let _0x2a4a41=0x0;_0x2a4a41<_0x5e00ae['length'];_0x2a4a41++){const _0x405480=_0x5e00ae[_0x2a4a41]/_0x343bd9;_0x1a471e[_0x2a4a41]=_0x405480;}return _0x1a471e;}['destroy'](){const _0x1f49b7=_0x676d52;Object['values'](this['windTextures'])['forEach'](_0xff8aa2=>_0xff8aa2['destroy']()),Object['values'](this['particlesTextures'])['forEach'](_0x2fe168=>_0x2fe168['destroy']()),Object['values'](this['primitives'])['forEach'](_0x23b3e5=>_0x23b3e5['destroy']()),this[_0x1f49b7(0x20d)]['destroy']();}}function _0x4546(_0x5641e0,_0x108d62){const _0x487c1d=_0x487c();return _0x4546=function(_0x4546a1,_0x297ff0){_0x4546a1=_0x4546a1-0x140;let _0x2f72e7=_0x487c1d[_0x4546a1];return _0x2f72e7;},_0x4546(_0x5641e0,_0x108d62);}const {Appearance,BufferUsage,Cartesian2,Color:Color$1,ComponentDatatype,Framebuffer,Geometry,GeometryAttribute,GeometryAttributes,PixelDatatype,PixelFormat,PrimitiveType,Sampler,SceneMode,Texture,TextureMagnificationFilter,TextureMinificationFilter,TextureWrap,VertexArray}=mars3d__namespace['Cesium'];class WindParticlesRendering{constructor(_0x2a409a,_0x506509,_0x820daa,_0x2019ca){const _0x4300df=_0x676d52;this['context']=_0x2a409a,this[_0x4300df(0x20c)]=_0x506509,this['viewerParameters']=_0x820daa,this['computing']=_0x2019ca,(typeof this[_0x4300df(0x20c)]['particlesTextureSize']!==_0x4300df(0x17b)||this['options']['particlesTextureSize']<=0x0)&&(console['error']('Invalid\x20particlesTextureSize.\x20Using\x20default\x20value\x20of\x20256.'),this['options'][_0x4300df(0x1fc)]=0x100),this['colorTable']=this['createColorTableTexture'](),this['textures']=this[_0x4300df(0x188)](),this['framebuffers']=this['createRenderingFramebuffers'](),this['primitives']=this[_0x4300df(0x19c)]();}['createRenderingTextures'](){const _0x1fe31f=_0x676d52,_0x5768bd={'context':this['context'],'width':this['context']['drawingBufferWidth'],'height':this[_0x1fe31f(0x175)]['drawingBufferHeight'],'pixelFormat':PixelFormat[_0x1fe31f(0x185)],'pixelDatatype':PixelDatatype['UNSIGNED_BYTE']},_0x2a0456={'context':this['context'],'width':this['context']['drawingBufferWidth'],'height':this[_0x1fe31f(0x175)][_0x1fe31f(0x1a3)],'pixelFormat':PixelFormat['DEPTH_COMPONENT'],'pixelDatatype':PixelDatatype['UNSIGNED_INT']};return{'segmentsColor':new Texture(_0x5768bd),'segmentsDepth':new Texture(_0x2a0456)};}[_0x676d52(0x1b3)](){const _0x4101a8=_0x676d52;return{'segments':new Framebuffer({'context':this['context'],'colorTextures':[this['textures'][_0x4101a8(0x212)]],'depthTexture':this[_0x4101a8(0x17f)][_0x4101a8(0x1ef)]})};}['destoryRenderingFramebuffers'](){const _0x2431b9=_0x676d52;Object[_0x2431b9(0x21f)](this[_0x2431b9(0x216)])['forEach'](_0x369124=>{const _0x4bb327=_0x2431b9;_0x369124[_0x4bb327(0x19b)]();});}[_0x676d52(0x142)](){const _0x38218c=_0x676d52,_0x31f804=new Float32Array(this[_0x38218c(0x20c)]['colors'][_0x38218c(0x179)](_0x1c3ee1=>{const _0x4ee59c=_0x38218c,_0x136567=Color$1[_0x4ee59c(0x217)](_0x1c3ee1);return[_0x136567['red'],_0x136567['green'],_0x136567['blue'],_0x136567['alpha']];}));return new Texture({'context':this['context'],'width':this[_0x38218c(0x20c)]['colors']['length'],'height':0x1,'pixelFormat':PixelFormat['RGBA'],'pixelDatatype':PixelDatatype['FLOAT'],'sampler':new Sampler({'minificationFilter':TextureMinificationFilter['LINEAR'],'magnificationFilter':TextureMagnificationFilter['LINEAR'],'wrapS':TextureWrap['CLAMP_TO_EDGE'],'wrapT':TextureWrap[_0x38218c(0x1fd)]}),'source':{'width':this['options'][_0x38218c(0x1e0)]['length'],'height':0x1,'arrayBufferView':_0x31f804}});}['createSegmentsGeometry'](){const _0x35c783=_0x676d52,_0x5575d3=0x4,_0x5f229e=this[_0x35c783(0x20c)]['particlesTextureSize'];let _0x4f9e30=[];for(let _0xd9f51=0x0;_0xd9f51<_0x5f229e;_0xd9f51++){for(let _0x121591=0x0;_0x121591<_0x5f229e;_0x121591++){for(let _0x22953e=0x0;_0x22953e<_0x5575d3;_0x22953e++){_0x4f9e30['push'](_0xd9f51/_0x5f229e),_0x4f9e30['push'](_0x121591/_0x5f229e);}}}_0x4f9e30=new Float32Array(_0x4f9e30);const _0x189c75=this[_0x35c783(0x20c)]['particlesTextureSize']**0x2;let _0x3b41a2=[];for(let _0x418698=0x0;_0x418698<_0x189c75;_0x418698++){_0x3b41a2['push'](-0x1,-0x1,0x0,-0x1,0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0);}_0x3b41a2=new Float32Array(_0x3b41a2);let _0x35faa8=[];for(let _0x24f30c=0x0,_0x1a34df=0x0;_0x24f30c<_0x189c75;_0x24f30c++){_0x35faa8[_0x35c783(0x16a)](_0x1a34df+0x0,_0x1a34df+0x1,_0x1a34df+0x2,_0x1a34df+0x2,_0x1a34df+0x1,_0x1a34df+0x3),_0x1a34df+=_0x5575d3;}_0x35faa8=new Uint32Array(_0x35faa8);const _0x2521de=new Geometry({'attributes':new GeometryAttributes({'st':new GeometryAttribute({'componentDatatype':ComponentDatatype['FLOAT'],'componentsPerAttribute':0x2,'values':_0x4f9e30}),'normal':new GeometryAttribute({'componentDatatype':ComponentDatatype['FLOAT'],'componentsPerAttribute':0x3,'values':_0x3b41a2})}),'indices':_0x35faa8});return _0x2521de;}['createRawRenderState'](_0x3af9d9){return Appearance['getDefaultRenderState'](!![],![],{'viewport':undefined,'depthTest':undefined,'depthMask':undefined,'blending':undefined,..._0x3af9d9});}['createPrimitives'](){const _0x70d195=_0x676d52,_0xcadf3d=new CustomPrimitive({'commandType':_0x70d195(0x1ee),'attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](),'primitiveType':PrimitiveType['TRIANGLES'],'uniformMap':{'previousParticlesPosition':()=>this['computing'][_0x70d195(0x16b)][_0x70d195(0x141)],'currentParticlesPosition':()=>this[_0x70d195(0x155)][_0x70d195(0x16b)]['currentParticlesPosition'],'postProcessingPosition':()=>this['computing']['particlesTextures'][_0x70d195(0x18b)],'particlesSpeed':()=>this[_0x70d195(0x155)]['particlesTextures']['particlesSpeed'],'frameRateAdjustment':()=>this['computing'][_0x70d195(0x1b5)],'colorTable':()=>this['colorTable'],'domain':()=>{const _0x31bbe7=_0x70d195;var _0x1b7777,_0x522924;const _0x2e61e4=new Cartesian2(((_0x1b7777=this['options']['domain'])===null||_0x1b7777===void 0x0?void 0x0:_0x1b7777['min'])??this['computing']['windData']['speed']['min'],((_0x522924=this['options']['domain'])===null||_0x522924===void 0x0?void 0x0:_0x522924['max'])??this[_0x31bbe7(0x155)]['windData'][_0x31bbe7(0x149)]['max']);return _0x2e61e4;},'displayRange':()=>{const _0x30327f=_0x70d195;var _0x10eca3,_0x2b25da;const _0xfc966c=new Cartesian2(((_0x10eca3=this['options']['displayRange'])===null||_0x10eca3===void 0x0?void 0x0:_0x10eca3['min'])??this['computing']['windData']['speed']['min'],((_0x2b25da=this[_0x30327f(0x20c)]['displayRange'])===null||_0x2b25da===void 0x0?void 0x0:_0x2b25da[_0x30327f(0x17e)])??this['computing'][_0x30327f(0x1a5)]['speed']['max']);return _0xfc966c;},'particleHeight':()=>this[_0x70d195(0x20c)]['fixedHeight']||0x0,'aspect':()=>this['context'][_0x70d195(0x151)]/this['context']['drawingBufferHeight'],'pixelSize':()=>this['viewerParameters'][_0x70d195(0x16f)],'lineWidth':()=>{const _0x4b1f35=_0x70d195,_0x1dbe79=this[_0x4b1f35(0x20c)]['lineWidth']||{'min':0x1,'max':0x2};return new Cartesian2(_0x1dbe79['min'],_0x1dbe79[_0x4b1f35(0x17e)]);},'lineLength':()=>{const _0x2920eb=_0x70d195,_0x3e4f59=this['options'][_0x2920eb(0x1ed)]||{'min':0x14,'max':0x64};return new Cartesian2(_0x3e4f59['min'],_0x3e4f59['max']);},'is3D':()=>this['viewerParameters']['sceneMode']===SceneMode[_0x70d195(0x172)],'segmentsDepthTexture':()=>this['textures']['segmentsDepth']},'vertexShaderSource':ShaderManager[_0x70d195(0x18d)](),'fragmentShaderSource':ShaderManager[_0x70d195(0x1b7)](),'rawRenderState':this['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![],'blending':{'enabled':!![],'blendEquation':WebGLRenderingContext[_0x70d195(0x14c)],'blendFuncSource':WebGLRenderingContext['SRC_ALPHA'],'blendFuncDestination':WebGLRenderingContext['ONE_MINUS_SRC_ALPHA']}})});return{'segments':_0xcadf3d};}[_0x676d52(0x1e8)](){const _0x2c0b45=_0x676d52,_0x565e8b=this['createSegmentsGeometry']();this['primitives']['segments']['geometry']=_0x565e8b;const _0x330890=VertexArray['fromGeometry']({'context':this['context'],'geometry':_0x565e8b,'attributeLocations':this['primitives']['segments']['attributeLocations'],'bufferUsage':BufferUsage[_0x2c0b45(0x19e)]});this['primitives']['segments'][_0x2c0b45(0x1b0)]&&(this['primitives']['segments'][_0x2c0b45(0x1b0)]['vertexArray']=_0x330890);}[_0x676d52(0x1f9)](){const _0x47e5b9=_0x676d52;this['colorTable']['destroy'](),this['colorTable']=this[_0x47e5b9(0x142)]();}['updateOptions'](_0x56f887){const _0x49be37=_0x676d52,_0x279fb0=_0x56f887['colors']&&JSON['stringify'](_0x56f887['colors'])!==JSON[_0x49be37(0x1e2)](this['options']['colors']);this['options']=deepMerge(_0x56f887,this['options']),_0x279fb0&&this['onColorTableChange']();}['destroy'](){const _0x15ed59=_0x676d52;Object['values'](this['framebuffers'])[_0x15ed59(0x207)](_0xaa57bf=>{const _0x3faa62=_0x15ed59;_0xaa57bf[_0x3faa62(0x19b)]();}),Object['values'](this['primitives'])['forEach'](_0x336dd2=>{const _0x2d9642=_0x15ed59;_0x336dd2[_0x2d9642(0x19b)]();}),this['colorTable']['destroy']();}}const {ClearCommand,Color,Pass}=mars3d__namespace['Cesium'];class WindParticleSystem{constructor(_0x28607d,_0x20dea0,_0x27cc3e,_0x4488b4,_0x43a3e0){const _0x3988d3=_0x676d52;this['context']=_0x28607d,this['options']=_0x27cc3e,this['viewerParameters']=_0x4488b4,this[_0x3988d3(0x155)]=new WindParticlesComputing(_0x28607d,_0x20dea0,_0x27cc3e,_0x4488b4,_0x43a3e0),this['rendering']=new WindParticlesRendering(_0x28607d,_0x27cc3e,_0x4488b4,this[_0x3988d3(0x155)]),this[_0x3988d3(0x1ff)]();}['getPrimitives'](){const _0x44043b=_0x676d52,_0x46c5b5=[this[_0x44043b(0x155)]['primitives']['calculateSpeed'],this['computing'][_0x44043b(0x15c)]['updatePosition'],this['computing'][_0x44043b(0x15c)]['postProcessingPosition'],this['rendering']['primitives'][_0x44043b(0x1bd)]];return _0x46c5b5;}['clearFramebuffers'](){const _0x1eec58=_0x676d52,_0x822f93=new ClearCommand({'color':new Color(0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Pass['OPAQUE']});Object['keys'](this[_0x1eec58(0x15d)][_0x1eec58(0x216)])[_0x1eec58(0x207)](_0x5b50dd=>{const _0x200df0=_0x1eec58;_0x822f93[_0x200df0(0x1a2)]=this['rendering']['framebuffers'][_0x5b50dd],_0x822f93['execute'](this['context']);});}['changeOptions'](_0x5d43f7){const _0x571762=_0x676d52;let _0x1020e0=![];_0x5d43f7['particlesTextureSize']&&this['options']['particlesTextureSize']!==_0x5d43f7['particlesTextureSize']&&(_0x1020e0=!![]);const _0x2e4e3b=deepMerge(_0x5d43f7,this['options']);if(_0x2e4e3b['particlesTextureSize']<0x1)throw new Error(_0x571762(0x210));this['options']=_0x2e4e3b,this['rendering']['updateOptions'](_0x5d43f7),this['computing']['updateOptions'](_0x5d43f7),_0x1020e0&&(this['computing']['destroyParticlesTextures'](),this[_0x571762(0x155)][_0x571762(0x1c6)](),this['rendering']['onParticlesTextureSizeChange']());}['applyViewerParameters'](_0x497e6d){const _0x3d1b1e=_0x676d52;this[_0x3d1b1e(0x1c4)]=_0x497e6d,this['computing']['viewerParameters']=_0x497e6d,this['rendering']['viewerParameters']=_0x497e6d;}['destroy'](){this['computing']['destroy'](),this['rendering']['destroy']();}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace[_0x676d52(0x167)]['BaseLayer'],DEF_OPTIONS={'particlesTextureSize':0x64,'fixedHeight':0x0,'lineWidth':{'min':0x1,'max':0x2},'lineLength':{'min':0x14,'max':0x64},'speedFactor':0x1,'dropRate':0.003,'dropRateBump':0.001,'colors':['rgb(206,255,255)'],'flipY':![],'dynamic':!![]};class WindLayer extends BaseLayer$1{constructor(_0x16f950={}){_0x16f950={...DEF_OPTIONS,..._0x16f950},super(_0x16f950),this['_setOptionsHook'](_0x16f950,_0x16f950);}get[_0x676d52(0x167)](){const _0x4e73d2=_0x676d52;return this[_0x4e73d2(0x15c)];}get[_0x676d52(0x189)](){const _0x366b66=_0x676d52;return this[_0x366b66(0x20c)][_0x366b66(0x189)];}set[_0x676d52(0x189)](_0x3aadd9){this['options']['data']=_0x3aadd9,this['setData'](_0x3aadd9);}get['colors'](){return this['options']['colors'];}set[_0x676d52(0x1e0)](_0x4d902d){const _0x474c09=_0x676d52;this['options']['colors']=_0x4d902d,this[_0x474c09(0x208)](this['options'],{'colors':_0x4d902d});}['_mountedHook'](){}['_addedHook'](){const _0x23309f=_0x676d52;this[_0x23309f(0x165)]=this['_map']['scene'],this[_0x23309f(0x1af)]=this['_map'][_0x23309f(0x1af)];this['options'][_0x23309f(0x189)]&&this['setData'](this['options']['data']);if(!this['windData'])return;this[_0x23309f(0x1c4)]={'lonRange':new Cesium$1[(_0x23309f(0x156))](-0xb4,0xb4),'latRange':new Cesium$1[(_0x23309f(0x156))](-0x5a,0x5a),'pixelSize':0x3e8,'sceneMode':this['scene']['mode']},this[_0x23309f(0x1cd)](),this['particleSystem']=new WindParticleSystem(this['scene']['context'],this[_0x23309f(0x1a5)],this['options'],this[_0x23309f(0x1c4)],this['scene']),this['primitives']=this[_0x23309f(0x215)]['getPrimitives'](),this['primitives']['forEach'](_0xd93ca3=>{const _0x2fb711=_0x23309f;this[_0x2fb711(0x165)]['primitives']['add'](_0xd93ca3);}),this['camera']['percentageChanged']=0.01,this[_0x23309f(0x1af)][_0x23309f(0x1d3)]['addEventListener'](this['updateViewerParameters'][_0x23309f(0x145)](this)),this['scene']['morphComplete']['addEventListener'](this[_0x23309f(0x1cd)][_0x23309f(0x145)](this)),window['addEventListener']('resize',this[_0x23309f(0x1cd)]['bind'](this));}['_removedHook'](){const _0x3d4104=_0x676d52;this[_0x3d4104(0x1af)]['changed']['removeEventListener'](this['updateViewerParameters']['bind'](this)),this[_0x3d4104(0x165)]['morphComplete']['removeEventListener'](this['updateViewerParameters']['bind'](this)),window['removeEventListener'](_0x3d4104(0x205),this[_0x3d4104(0x1cd)]['bind'](this)),this[_0x3d4104(0x15c)]&&(this[_0x3d4104(0x15c)][_0x3d4104(0x207)](_0x5e9ec4=>{const _0x1c2509=_0x3d4104;this[_0x1c2509(0x165)]['primitives']['remove'](_0x5e9ec4);}),delete this['primitives']),this['particleSystem']&&(this['particleSystem'][_0x3d4104(0x19b)](),delete this['particleSystem']);}['setData'](_0x176036,_0x385fdb){const _0x54349b=_0x676d52;this[_0x54349b(0x1a5)]=this['processWindData'](_0x176036);if(_0x385fdb){this['_removedHook'](),this[_0x54349b(0x143)]();return;}this[_0x54349b(0x215)]?(this['particleSystem'][_0x54349b(0x155)]['updateWindData'](this[_0x54349b(0x1a5)]),this['scene'][_0x54349b(0x1be)]()):this[_0x54349b(0x143)]();}[_0x676d52(0x208)](_0x16dfe5,_0x149491){const _0x44ef44=_0x676d52;this[_0x44ef44(0x215)]&&(this['particleSystem']['changeOptions'](_0x149491),this[_0x44ef44(0x165)]['requestRender']());}['processWindData'](_0x3c43b6){const _0x4cffe9=_0x676d52;var _0x292070,_0x4dca62;const _0x109488={..._0x3c43b6};!_0x109488[_0x4cffe9(0x1ad)]&&_0x109488['rows']&&(_0x109488['height']=_0x109488[_0x4cffe9(0x1f6)]);!_0x109488['width']&&_0x109488['cols']&&(_0x109488['width']=_0x109488['cols']);!_0x109488['bounds']&&(_0x109488[_0x4cffe9(0x183)]={'west':_0x109488['xmin'],'south':_0x109488['ymin'],'east':_0x109488['xmax'],'north':_0x109488['ymax']});!_0x109488['u']&&(_0x109488['u']={'array':_0x3c43b6['udata'],'min':_0x3c43b6['umin'],'max':_0x3c43b6['umax']});!_0x109488['v']&&(_0x109488['v']={'array':_0x3c43b6['vdata'],'min':_0x3c43b6[_0x4cffe9(0x1f5)],'max':_0x3c43b6['vmax']});if(((_0x292070=_0x109488[_0x4cffe9(0x149)])===null||_0x292070===void 0x0?void 0x0:_0x292070['min'])===undefined||((_0x4dca62=_0x109488['speed'])===null||_0x4dca62===void 0x0?void 0x0:_0x4dca62[_0x4cffe9(0x17e)])===undefined||_0x109488[_0x4cffe9(0x149)]['array']===undefined){const _0x2891e5={'array':new Float32Array(_0x109488['u'][_0x4cffe9(0x1d2)][_0x4cffe9(0x1fa)]),'min':Number[_0x4cffe9(0x1d6)],'max':Number['MIN_VALUE']};for(let _0xbb1836=0x0;_0xbb1836<_0x109488['u'][_0x4cffe9(0x1d2)][_0x4cffe9(0x1fa)];_0xbb1836++){_0x2891e5['array'][_0xbb1836]=Math['sqrt'](_0x109488['u']['array'][_0xbb1836]*_0x109488['u']['array'][_0xbb1836]+_0x109488['v'][_0x4cffe9(0x1d2)][_0xbb1836]*_0x109488['v']['array'][_0xbb1836]),_0x2891e5[_0x4cffe9(0x1d2)][_0xbb1836]!==0x0&&(_0x2891e5['min']=Math[_0x4cffe9(0x15e)](_0x2891e5['min'],_0x2891e5['array'][_0xbb1836]),_0x2891e5[_0x4cffe9(0x17e)]=Math[_0x4cffe9(0x17e)](_0x2891e5['max'],_0x2891e5['array'][_0xbb1836]));}_0x109488['speed']=_0x2891e5;}return _0x109488;}['updateViewerParameters'](){const _0xfd1ff5=_0x676d52;var _0x252a85;const _0x281e70=this['scene'],_0xbca854=_0x281e70['canvas'],_0xb8cf2f=[{'x':0x0,'y':0x0},{'x':0x0,'y':_0xbca854[_0xfd1ff5(0x197)]},{'x':_0xbca854['clientWidth'],'y':0x0},{'x':_0xbca854['clientWidth'],'y':_0xbca854['clientHeight']}];let _0x214d7e=0xb4,_0x571840=-0xb4,_0x3cb08e=0x5a,_0x2cbfc3=-0x5a,_0x5cfc15=![];for(const _0x4ee76d of _0xb8cf2f){const _0x3d89fa=_0x281e70['camera'][_0xfd1ff5(0x1f4)](new Cesium$1[(_0xfd1ff5(0x156))](_0x4ee76d['x'],_0x4ee76d['y']),_0x281e70['globe']['ellipsoid']);if(!_0x3d89fa){_0x5cfc15=!![];break;}const _0x1bf482=_0x281e70['globe'][_0xfd1ff5(0x16c)][_0xfd1ff5(0x1d5)](_0x3d89fa),_0x1e9dfd=Cesium$1[_0xfd1ff5(0x20e)]['toDegrees'](_0x1bf482[_0xfd1ff5(0x1ca)]),_0x493e44=Cesium$1['Math']['toDegrees'](_0x1bf482['latitude']);_0x214d7e=Math[_0xfd1ff5(0x15e)](_0x214d7e,_0x1e9dfd),_0x571840=Math['max'](_0x571840,_0x1e9dfd),_0x3cb08e=Math['min'](_0x3cb08e,_0x493e44),_0x2cbfc3=Math[_0xfd1ff5(0x17e)](_0x2cbfc3,_0x493e44);}if(!_0x5cfc15){const _0x57c0f7=new Cesium$1['Cartesian2'](Math['max'](this['windData']['bounds']['west'],_0x214d7e),Math[_0xfd1ff5(0x15e)](this['windData']['bounds'][_0xfd1ff5(0x198)],_0x571840)),_0x52e413=new Cesium$1['Cartesian2'](Math['max'](this['windData']['bounds']['south'],_0x3cb08e),Math['min'](this[_0xfd1ff5(0x1a5)]['bounds']['north'],_0x2cbfc3)),_0x3beea8=(_0x57c0f7['y']-_0x57c0f7['x'])*0.05,_0x35c5ce=(_0x52e413['y']-_0x52e413['x'])*0.05;_0x57c0f7['x']=Math[_0xfd1ff5(0x17e)](this['windData']['bounds']['west'],_0x57c0f7['x']-_0x3beea8),_0x57c0f7['y']=Math['min'](this['windData']['bounds'][_0xfd1ff5(0x198)],_0x57c0f7['y']+_0x3beea8),_0x52e413['x']=Math['max'](this['windData']['bounds']['south'],_0x52e413['x']-_0x35c5ce),_0x52e413['y']=Math[_0xfd1ff5(0x15e)](this['windData']['bounds']['north'],_0x52e413['y']+_0x35c5ce),this['viewerParameters'][_0xfd1ff5(0x1b1)]=_0x57c0f7,this['viewerParameters'][_0xfd1ff5(0x1ab)]=_0x52e413;const _0x54d2ee=this['windData'][_0xfd1ff5(0x183)]['east']-this['windData']['bounds']['west'],_0x15d558=this['windData']['bounds']['north']-this['windData']['bounds'][_0xfd1ff5(0x1d4)],_0xb95be0=(_0x57c0f7['y']-_0x57c0f7['x'])/_0x54d2ee,_0x537b5b=(_0x52e413['y']-_0x52e413['x'])/_0x15d558,_0x3af772=Math['min'](_0xb95be0,_0x537b5b),_0x19239c=0x3e8*_0x3af772;_0x19239c>0x0&&(this['viewerParameters']['pixelSize']=Math[_0xfd1ff5(0x17e)](0x0,Math['min'](0x3e8,_0x19239c)));}this[_0xfd1ff5(0x1c4)]['sceneMode']=this['scene']['mode'],(_0x252a85=this[_0xfd1ff5(0x215)])===null||_0x252a85===void 0x0||_0x252a85['applyViewerParameters'](this['viewerParameters']);}['getDataAtLonLat'](_0x470e99,_0x368b43){const _0x19b71f=_0x676d52,{bounds:_0x212f0b,width:_0x629398,height:_0x47a9cf,u:_0x2582ad,v:_0x4dd83d,speed:_0x5405c5}=this['windData'],{flipY:_0x2f0837}=this[_0x19b71f(0x20c)];if(_0x470e99<_0x212f0b[_0x19b71f(0x158)]||_0x470e99>_0x212f0b['east']||_0x368b43<_0x212f0b[_0x19b71f(0x1d4)]||_0x368b43>_0x212f0b['north'])return null;const _0x462848=(_0x470e99-_0x212f0b['west'])/(_0x212f0b['east']-_0x212f0b['west'])*(_0x629398-0x1);let _0x3556ab=(_0x368b43-_0x212f0b['south'])/(_0x212f0b['north']-_0x212f0b['south'])*(_0x47a9cf-0x1);_0x2f0837&&(_0x3556ab=_0x47a9cf-0x1-_0x3556ab);const _0x341984=Math[_0x19b71f(0x1ae)](_0x462848),_0x3be0da=Math['floor'](_0x3556ab),_0x2ad9ba=Math['floor'](_0x462848),_0x5596a1=Math['min'](_0x2ad9ba+0x1,_0x629398-0x1),_0x94e99c=Math['floor'](_0x3556ab),_0x276301=Math['min'](_0x94e99c+0x1,_0x47a9cf-0x1),_0x17f3ef=_0x462848-_0x2ad9ba,_0x303958=_0x3556ab-_0x94e99c,_0xf58fe8=_0x3be0da*_0x629398+_0x341984,_0x1c022e=_0x94e99c*_0x629398+_0x2ad9ba,_0x13fd11=_0x94e99c*_0x629398+_0x5596a1,_0x15c1d0=_0x276301*_0x629398+_0x2ad9ba,_0x5c9d58=_0x276301*_0x629398+_0x5596a1,_0x13d6cb=_0x2582ad['array'][_0x1c022e],_0x3ec193=_0x2582ad['array'][_0x13fd11],_0x3b6db6=_0x2582ad['array'][_0x15c1d0],_0x3a8883=_0x2582ad[_0x19b71f(0x1d2)][_0x5c9d58],_0x15ee62=(0x1-_0x17f3ef)*(0x1-_0x303958)*_0x13d6cb+_0x17f3ef*(0x1-_0x303958)*_0x3ec193+(0x1-_0x17f3ef)*_0x303958*_0x3b6db6+_0x17f3ef*_0x303958*_0x3a8883,_0x19bf23=_0x4dd83d['array'][_0x1c022e],_0x26f81b=_0x4dd83d[_0x19b71f(0x1d2)][_0x13fd11],_0x5f54a5=_0x4dd83d['array'][_0x15c1d0],_0x5f1662=_0x4dd83d['array'][_0x5c9d58],_0x3f89db=(0x1-_0x17f3ef)*(0x1-_0x303958)*_0x19bf23+_0x17f3ef*(0x1-_0x303958)*_0x26f81b+(0x1-_0x17f3ef)*_0x303958*_0x5f54a5+_0x17f3ef*_0x303958*_0x5f1662,_0x2de174=Math['sqrt'](_0x15ee62*_0x15ee62+_0x3f89db*_0x3f89db);return{'original':{'u':_0x2582ad[_0x19b71f(0x1d2)][_0xf58fe8],'v':_0x4dd83d[_0x19b71f(0x1d2)][_0xf58fe8],'speed':_0x5405c5['array'][_0xf58fe8]},'interpolated':{'u':_0x15ee62,'v':_0x3f89db,'speed':_0x2de174}};}}mars3d__namespace['LayerUtil']['register']('wind',WindLayer),mars3d__namespace['layer'][_0x676d52(0x214)]=WindLayer;class CanvasParticle{constructor(){const _0x1ba7bb=_0x676d52;this['lng']=null,this[_0x1ba7bb(0x173)]=null,this['tlng']=null,this['tlat']=null,this[_0x1ba7bb(0x160)]=null,this['speed']=null;}['destroy'](){for(const _0x3ae82a in this){delete this[_0x3ae82a];}}}class CanvasWindField{constructor(_0x1e5209){this['setOptions'](_0x1e5209);}get[_0x676d52(0x157)](){return this['_speedRate'];}set['speedRate'](_0x1ba190){const _0x35b9d5=_0x676d52;this[_0x35b9d5(0x220)]=(0x64-(_0x1ba190>0x63?0x63:_0x1ba190))*0x64,this['_calc_speedRate']=[(this['xmax']-this['xmin'])/this[_0x35b9d5(0x220)],(this[_0x35b9d5(0x1e9)]-this[_0x35b9d5(0x1bf)])/this['_speedRate']];}get['maxAge'](){const _0x1202d3=_0x676d52;return this[_0x1202d3(0x162)];}set[_0x676d52(0x190)](_0x32a27c){this['_maxAge']=_0x32a27c;}['setOptions'](_0x5b0700){const _0x564e90=_0x676d52;this['options']=_0x5b0700,this['maxAge']=_0x5b0700['maxAge']||0x78,this['speedRate']=_0x5b0700[_0x564e90(0x157)]||0x32,this['particles']=[];const _0x2c0ae4=_0x5b0700['particlesNumber']||0x1000;for(let _0x5eb282=0x0;_0x5eb282<_0x2c0ae4;_0x5eb282++){const _0xaafa8c=this['_randomParticle'](new CanvasParticle());this['particles']['push'](_0xaafa8c);}}['setDate'](_0x1e92c6){const _0x1ad522=_0x676d52;this['rows']=_0x1e92c6[_0x1ad522(0x1f6)],this['cols']=_0x1e92c6['cols'],this['xmin']=_0x1e92c6['xmin'],this['xmax']=_0x1e92c6['xmax'],this['ymin']=_0x1e92c6[_0x1ad522(0x1bf)],this['ymax']=_0x1e92c6['ymax'],this['grid']=[];const _0x2b8f0e=_0x1e92c6['udata'],_0x5b1c80=_0x1e92c6['vdata'];let _0x167bb1=![];_0x2b8f0e['length']===this[_0x1ad522(0x1f6)]&&_0x2b8f0e[0x0][_0x1ad522(0x1fa)]===this['cols']&&(_0x167bb1=!![]);let _0x3c8fb0=0x0,_0x22ba34=null,_0x17ee1c=null;for(let _0x3d23f4=0x0;_0x3d23f4<this['rows'];_0x3d23f4++){_0x22ba34=[];for(let _0xf636c=0x0;_0xf636c<this['cols'];_0xf636c++,_0x3c8fb0++){_0x167bb1?_0x17ee1c=this['_calcUV'](_0x2b8f0e[_0x3d23f4][_0xf636c],_0x5b1c80[_0x3d23f4][_0xf636c]):_0x17ee1c=this['_calcUV'](_0x2b8f0e[_0x3c8fb0],_0x5b1c80[_0x3c8fb0]),_0x22ba34['push'](_0x17ee1c);}this[_0x1ad522(0x1a6)]['push'](_0x22ba34);}!this[_0x1ad522(0x20c)][_0x1ad522(0x17c)]&&this['grid']['reverse']();}['clear'](){const _0x400f5c=_0x676d52;delete this[_0x400f5c(0x1f6)],delete this[_0x400f5c(0x1d9)],delete this['xmin'],delete this['xmax'],delete this[_0x400f5c(0x1bf)],delete this['ymax'],delete this[_0x400f5c(0x1a6)],delete this['particles'];}['toGridXY'](_0x45ab3b,_0xc72073){const _0x43603e=_0x676d52,_0x55867c=(_0x45ab3b-this['xmin'])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0x5102d6=(this['ymax']-_0xc72073)/(this[_0x43603e(0x1e9)]-this['ymin'])*(this[_0x43603e(0x1f6)]-0x1);return[_0x55867c,_0x5102d6];}['getUVByXY'](_0x24e0d8,_0x2f93ec){const _0x4522cb=_0x676d52;if(_0x24e0d8<0x0||_0x24e0d8>=this['cols']||_0x2f93ec>=this['rows'])return[0x0,0x0,0x0];const _0x540329=Math[_0x4522cb(0x1ae)](_0x24e0d8),_0x322e8f=Math['floor'](_0x2f93ec);if(_0x540329===_0x24e0d8&&_0x322e8f===_0x2f93ec)return this['grid'][_0x2f93ec][_0x24e0d8];const _0x547cb9=_0x540329+0x1,_0x11fb40=_0x322e8f+0x1,_0x1801d7=this['getUVByXY'](_0x540329,_0x322e8f),_0x50e802=this[_0x4522cb(0x1f7)](_0x547cb9,_0x322e8f),_0x2e6211=this[_0x4522cb(0x1f7)](_0x540329,_0x11fb40),_0x2a4e53=this['getUVByXY'](_0x547cb9,_0x11fb40);let _0x8e2422=null;try{_0x8e2422=this['_bilinearInterpolation'](_0x24e0d8-_0x540329,_0x2f93ec-_0x322e8f,_0x1801d7,_0x50e802,_0x2e6211,_0x2a4e53);}catch(_0x7b74bc){console['log'](_0x24e0d8,_0x2f93ec);}return _0x8e2422;}['_bilinearInterpolation'](_0x368de4,_0x5613d1,_0x454bc8,_0x5958de,_0x30f17f,_0x4136af){const _0x44d5c9=0x1-_0x368de4,_0x5b266c=0x1-_0x5613d1,_0x238be2=_0x44d5c9*_0x5b266c,_0x2f3242=_0x368de4*_0x5b266c,_0x524489=_0x44d5c9*_0x5613d1,_0x22b434=_0x368de4*_0x5613d1,_0x54a99a=_0x454bc8[0x0]*_0x238be2+_0x5958de[0x0]*_0x2f3242+_0x30f17f[0x0]*_0x524489+_0x4136af[0x0]*_0x22b434,_0x5865a1=_0x454bc8[0x1]*_0x238be2+_0x5958de[0x1]*_0x2f3242+_0x30f17f[0x1]*_0x524489+_0x4136af[0x1]*_0x22b434;return this['_calcUV'](_0x54a99a,_0x5865a1);}['_calcUV'](_0x2b510a,_0x474f07){return[+_0x2b510a,+_0x474f07,Math['sqrt'](_0x2b510a*_0x2b510a+_0x474f07*_0x474f07)];}[_0x676d52(0x14e)](_0x31fdb4,_0x4acdd6){if(!this['isInExtent'](_0x31fdb4,_0x4acdd6))return null;const _0x53ffb4=this['toGridXY'](_0x31fdb4,_0x4acdd6),_0x3b9d43=this['getUVByXY'](_0x53ffb4[0x0],_0x53ffb4[0x1]);return _0x3b9d43;}['isInExtent'](_0x19f026,_0xdfb61c){const _0x3750df=_0x676d52;return _0x19f026>=this['xmin']&&_0x19f026<=this['xmax']&&_0xdfb61c>=this[_0x3750df(0x1bf)]&&_0xdfb61c<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x550fd9=_0x676d52,_0x520ed6=fRandomByfloat(this[_0x550fd9(0x14a)],this['xmax']),_0x4df61f=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x4df61f,'lng':_0x520ed6};}[_0x676d52(0x200)](){const _0x26be84=_0x676d52;let _0x11816b,_0x12bc2a,_0x126359;for(let _0x1447c6=0x0,_0x603cca=this[_0x26be84(0x16e)]['length'];_0x1447c6<_0x603cca;_0x1447c6++){let _0x4b0ac1=this['particles'][_0x1447c6];_0x4b0ac1['age']<=0x0&&(_0x4b0ac1=this[_0x26be84(0x191)](_0x4b0ac1));if(_0x4b0ac1['age']>0x0){const _0x36e500=_0x4b0ac1['tlng'],_0xa974e0=_0x4b0ac1['tlat'];_0x126359=this['getUVByPoint'](_0x36e500,_0xa974e0),_0x126359?(_0x11816b=_0x36e500+this[_0x26be84(0x1c7)][0x0]*_0x126359[0x0],_0x12bc2a=_0xa974e0+this[_0x26be84(0x1c7)][0x1]*_0x126359[0x1],_0x4b0ac1['lng']=_0x36e500,_0x4b0ac1[_0x26be84(0x173)]=_0xa974e0,_0x4b0ac1[_0x26be84(0x1e7)]=_0x11816b,_0x4b0ac1[_0x26be84(0x21b)]=_0x12bc2a,_0x4b0ac1[_0x26be84(0x149)]=_0x126359[0x2],_0x4b0ac1['age']--):_0x4b0ac1[_0x26be84(0x160)]=0x0;}}return this['particles'];}['_randomParticle'](_0x80296){const _0x2b9b6a=_0x676d52;let _0xd7168f,_0x24f414;for(let _0x3e3d32=0x0;_0x3e3d32<0x1e;_0x3e3d32++){_0xd7168f=this['getRandomLatLng'](),_0x24f414=this['getUVByPoint'](_0xd7168f['lng'],_0xd7168f[_0x2b9b6a(0x173)]);if(_0x24f414&&_0x24f414[0x2]>0x0)break;}if(!_0x24f414)return _0x80296;const _0x56b032=_0xd7168f[_0x2b9b6a(0x1da)]+this['_calc_speedRate'][0x0]*_0x24f414[0x0],_0x53ee59=_0xd7168f[_0x2b9b6a(0x173)]+this[_0x2b9b6a(0x1c7)][0x1]*_0x24f414[0x1];return _0x80296['lng']=_0xd7168f['lng'],_0x80296['lat']=_0xd7168f[_0x2b9b6a(0x173)],_0x80296['tlng']=_0x56b032,_0x80296['tlat']=_0x53ee59,_0x80296[_0x2b9b6a(0x160)]=Math['round'](0xa+Math['random']()*this[_0x2b9b6a(0x190)]),_0x80296['speed']=_0x24f414[0x2],_0x80296;}[_0x676d52(0x19b)](){for(const _0x14e5a0 in this){delete this[_0x14e5a0];}}}function fRandomByfloat(_0x1996b2,_0x42f660){const _0x35def7=_0x676d52;return _0x1996b2+Math[_0x35def7(0x177)]()*(_0x42f660-_0x1996b2);}const Cesium=mars3d__namespace[_0x676d52(0x1df)],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x38ee94={}){const _0x44df0d=_0x676d52;super(_0x38ee94),this[_0x44df0d(0x208)](_0x38ee94),this[_0x44df0d(0x1f8)]=null,_0x38ee94[_0x44df0d(0x1e0)]&&_0x38ee94[_0x44df0d(0x15a)]&&(this['_colorRamp']=new mars3d__namespace[(_0x44df0d(0x170))](_0x38ee94));}['_setOptionsHook'](_0x17b9a3,_0x4e0c3d){const _0x5dac9a=_0x676d52;this['frameTime']=0x3e8/(_0x17b9a3['frameRate']||0xa),this['_pointerEvents']=this['options']['pointerEvents']??![],this[_0x5dac9a(0x193)]=_0x17b9a3['color']||_0x5dac9a(0x174),this['lineWidth']=_0x17b9a3['lineWidth']||0x1,this[_0x5dac9a(0x1f2)]=_0x17b9a3['fixedHeight']??0x0,this['flipY']=_0x17b9a3['flipY']??![],this['windField']&&this['windField']['setOptions'](_0x17b9a3);}get['layer'](){return this['canvas'];}get['canvasWidth'](){const _0xb36e7=_0x676d52;return this['_map']['scene'][_0xb36e7(0x1f8)]['clientWidth'];}get['canvasHeight'](){const _0x28d5b2=_0x676d52;return this['_map'][_0x28d5b2(0x165)]['canvas']['clientHeight'];}get['pointerEvents'](){return this['_pointerEvents'];}set[_0x676d52(0x201)](_0x5b3ffd){const _0x566685=_0x676d52;this[_0x566685(0x1cb)]=_0x5b3ffd;if(!this['canvas'])return;_0x5b3ffd?this['canvas']['style'][_0x566685(0x1d1)]=_0x566685(0x166):this['canvas'][_0x566685(0x186)]['pointer-events']=_0x566685(0x196);}get[_0x676d52(0x140)](){const _0xd16dbc=_0x676d52;return this['options'][_0xd16dbc(0x140)];}set['particlesNumber'](_0x1cb403){this['options']['particlesNumber']=_0x1cb403,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){const _0x409dec=_0x676d52;return this[_0x409dec(0x20c)]['speedRate'];}set[_0x676d52(0x157)](_0x660b2d){this['options']['speedRate']=_0x660b2d,this['windField']&&(this['windField']['speedRate']=_0x660b2d);}get['maxAge'](){return this['options']['maxAge'];}set['maxAge'](_0x8f105b){this['options']['maxAge']=_0x8f105b,this['windField']&&(this['windField']['maxAge']=_0x8f105b);}get['data'](){const _0x25220f=_0x676d52;return this[_0x25220f(0x1a5)];}set['data'](_0x44682e){this['setData'](_0x44682e);}get['rectangle'](){const _0x238f2a=_0x676d52;let _0x2ca4f4=this[_0x238f2a(0x1a5)][_0x238f2a(0x14a)],_0x2a6151=this[_0x238f2a(0x1a5)][_0x238f2a(0x1d0)],_0x25f158=this['windData']['ymin'],_0x1d24cf=this['windData'][_0x238f2a(0x1e9)];return _0x2a6151>=0x167&&_0x2ca4f4===0x0&&(_0x2ca4f4=-0xb4,_0x2a6151=0xb4),_0x2ca4f4=Math[_0x238f2a(0x17e)](_0x2ca4f4,-0xb4),_0x2a6151=Math['min'](_0x2a6151,0xb4),_0x25f158=Math['max'](_0x25f158,-0x5a),_0x1d24cf=Math['min'](_0x1d24cf,0x5a),Cesium['Rectangle']['fromDegrees'](_0x2ca4f4,_0x25f158,_0x2a6151,_0x1d24cf);}['_showHook'](_0x456f27){const _0x34866f=_0x676d52;_0x456f27?this['_addedHook']():(this['windData']&&(this['options']['data']=this['windData']),this[_0x34866f(0x202)]());}['_mountedHook'](){const _0x6db8cf=_0x676d52;this['options'][_0x6db8cf(0x17a)]?this['initWorker']():this['windField']=new CanvasWindField(this[_0x6db8cf(0x20c)]);}['_addedHook'](){const _0x1b5cad=_0x676d52;this['canvas']=this[_0x1b5cad(0x1b6)](),this['canvasContext']=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this['setData'](this['options']['data']);}['_removedHook'](){const _0x22ce97=_0x676d52;this['clear'](),this['unbindEvent'](),this[_0x22ce97(0x1f8)]&&(this['_map']['container']['removeChild'](this['canvas']),delete this['canvas']);}['_createCanvas'](){const _0xf50fa2=_0x676d52,_0x56c146=mars3d__namespace['DomUtil']['create'](_0xf50fa2(0x1f8),'mars3d-canvasWind',this['_map']['container']);return _0x56c146['style'][_0xf50fa2(0x1ea)]='absolute',_0x56c146['style']['top']='0px',_0x56c146['style']['left']='0px',_0x56c146[_0xf50fa2(0x186)]['width']=this['_map']['scene'][_0xf50fa2(0x1f8)][_0xf50fa2(0x1cc)]+'px',_0x56c146['style']['height']=this['_map'][_0xf50fa2(0x165)][_0xf50fa2(0x1f8)][_0xf50fa2(0x197)]+'px',_0x56c146[_0xf50fa2(0x186)]['pointerEvents']=this['_pointerEvents']?'auto':_0xf50fa2(0x196),_0x56c146['style']['zIndex']=this['options'][_0xf50fa2(0x1eb)]??0x9,_0x56c146['width']=this['_map']['scene'][_0xf50fa2(0x1f8)][_0xf50fa2(0x1cc)],_0x56c146['height']=this['_map'][_0xf50fa2(0x165)][_0xf50fa2(0x1f8)]['clientHeight'],_0x56c146;}['resize'](){const _0x1e745a=_0x676d52;this['canvas']&&(this['canvas'][_0x1e745a(0x186)]['width']=this['_map']['scene']['canvas']['clientWidth']+'px',this['canvas'][_0x1e745a(0x186)]['height']=this['_map']['scene']['canvas'][_0x1e745a(0x197)]+'px',this[_0x1e745a(0x1f8)]['width']=this['_map']['scene']['canvas'][_0x1e745a(0x1cc)],this[_0x1e745a(0x1f8)]['height']=this[_0x1e745a(0x1db)][_0x1e745a(0x165)][_0x1e745a(0x1f8)]['clientHeight']);}['bindEvent'](){const _0x720f57=_0x676d52,_0x5276e2=this;let _0x3745e7=Date['now']();(function _0x3f6ae3(){const _0x22d76c=_0x4546;if(_0x5276e2['isDestroy'])return;_0x5276e2['_animateFrame']=window['requestAnimationFrame'](_0x3f6ae3);if(_0x5276e2['show']&&_0x5276e2['windField']){const _0x454b21=Date[_0x22d76c(0x219)](),_0x1fa553=_0x454b21-_0x3745e7;_0x1fa553>_0x5276e2['frameTime']&&(_0x3745e7=_0x454b21-_0x1fa553%_0x5276e2['frameTime'],_0x5276e2['update']());}}(),window['addEventListener']('resize',this['resize'][_0x720f57(0x145)](this),![]),this[_0x720f57(0x148)]=![],this['mouse_move']=![],this['options']['mouseHidden']&&(this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x720f57(0x1db)]['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x720f57(0x1c0)],this[_0x720f57(0x19a)],this)));}['unbindEvent'](){const _0x3b1966=_0x676d52;window['cancelAnimationFrame'](this['_animateFrame']),delete this['_animateFrame'],window[_0x3b1966(0x199)]('resize',this['resize']),this['options'][_0x3b1966(0x163)]&&(this['_map']['off'](mars3d__namespace['EventType']['wheel'],this[_0x3b1966(0x20f)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this[_0x3b1966(0x1db)][_0x3b1966(0x1a1)](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace[_0x3b1966(0x211)][_0x3b1966(0x176)],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x5ab6c1){const _0x42fa8f=_0x676d52;clearTimeout(this['refreshTimer']);if(!this['show']||!this['canvas'])return;this['canvas'][_0x42fa8f(0x186)][_0x42fa8f(0x19d)]=_0x42fa8f(0x1c2),this['refreshTimer']=setTimeout(()=>{const _0x42b367=_0x42fa8f;if(!this['show'])return;this['redraw'](),this['canvas'][_0x42b367(0x186)][_0x42b367(0x19d)]=_0x42b367(0x1a4);},0xc8);}['_onMouseDownEvent'](_0x518341){const _0x567ffe=_0x676d52;this['mouse_down']=!![],this['_map'][_0x567ffe(0x1a1)](mars3d__namespace[_0x567ffe(0x211)]['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x567ffe(0x1db)]['on'](mars3d__namespace[_0x567ffe(0x211)]['mouseMove'],this[_0x567ffe(0x18f)],this);}['_onMouseMoveEvent'](_0x17497b){const _0x4b74bc=_0x676d52;if(!this[_0x4b74bc(0x1a9)]||!this['canvas'])return;this['mouse_down']&&(this['canvas']['style']['visibility']='hidden',this[_0x4b74bc(0x17d)]=!![]);}['_onMouseUpEvent'](_0x2c8ec4){const _0x204315=_0x676d52;if(!this['show']||!this['canvas'])return;this[_0x204315(0x1db)][_0x204315(0x1a1)](mars3d__namespace['EventType']['mouseMove'],this[_0x204315(0x18f)],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this[_0x204315(0x1f8)]['style']['visibility']='visible',this[_0x204315(0x148)]=![],this['mouse_move']=![];}['setData'](_0x16f3f1){const _0x41b7fc=_0x676d52;this['clear'](),this['windData']=_0x16f3f1,this['windField'][_0x41b7fc(0x1fe)](_0x16f3f1),this[_0x41b7fc(0x1e1)]();}['redraw'](){const _0x5ba374=_0x676d52;if(!this[_0x5ba374(0x1a9)])return;this['windField']['setOptions'](this['options']),this['update']();}['update'](){const _0x5055ec=_0x676d52;if(this['_updateIng'])return;this['_updateIng']=!![];if(this[_0x5055ec(0x17a)])this['windField']['update']();else{const _0x57c0a0=this[_0x5055ec(0x20a)][_0x5055ec(0x200)]();this['_drawLines'](_0x57c0a0);}this[_0x5055ec(0x194)]=![];}['_drawLines'](_0x584aee){const _0x14b3b4=_0x676d52;this[_0x14b3b4(0x1b4)]=_0x584aee,this['canvasContext'][_0x14b3b4(0x1b9)]=_0x14b3b4(0x213),this[_0x14b3b4(0x146)]['fillRect'](0x0,0x0,this['canvasWidth'],this[_0x14b3b4(0x21c)]),this['canvasContext'][_0x14b3b4(0x1b9)]='lighter',this['canvasContext']['globalAlpha']=0.9;const _0x153341=this[_0x14b3b4(0x1db)][_0x14b3b4(0x165)]['mode']!==Cesium['SceneMode'][_0x14b3b4(0x172)],_0x29a3fb=this['canvasWidth']*0.25;if(this['_colorRamp'])for(let _0x3c9417=0x0,_0x5919d2=_0x584aee['length'];_0x3c9417<_0x5919d2;_0x3c9417++){const _0x45bba6=_0x584aee[_0x3c9417],_0x4a15c9=this['_tomap'](_0x45bba6,_0x45bba6['lng'],_0x45bba6[_0x14b3b4(0x173)],_0x45bba6[_0x14b3b4(0x184)]),_0x485cae=this['_tomap'](_0x45bba6,_0x45bba6['tlng'],_0x45bba6[_0x14b3b4(0x21b)],_0x45bba6['talt']);if(!_0x4a15c9||!_0x485cae)continue;if(_0x153341&&Math['abs'](_0x4a15c9[0x0]-_0x485cae[0x0])>=_0x29a3fb)continue;this['canvasContext']['beginPath'](),this[_0x14b3b4(0x146)][_0x14b3b4(0x1cf)]=this[_0x14b3b4(0x1cf)],this['canvasContext']['strokeStyle']=this['_colorRamp']['getColor'](_0x45bba6['speed']),this['canvasContext']['moveTo'](_0x4a15c9[0x0],_0x4a15c9[0x1]),this['canvasContext'][_0x14b3b4(0x1bc)](_0x485cae[0x0],_0x485cae[0x1]),this['canvasContext']['stroke']();}else{this['canvasContext']['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this[_0x14b3b4(0x146)]['strokeStyle']=this['color'];for(let _0x1c538d=0x0,_0x26d5fa=_0x584aee['length'];_0x1c538d<_0x26d5fa;_0x1c538d++){const _0x408ca5=_0x584aee[_0x1c538d],_0x1bab8d=this[_0x14b3b4(0x1e6)](_0x408ca5,_0x408ca5[_0x14b3b4(0x1da)],_0x408ca5['lat'],_0x408ca5['alt']),_0x3b5a04=this[_0x14b3b4(0x1e6)](_0x408ca5,_0x408ca5[_0x14b3b4(0x1e7)],_0x408ca5[_0x14b3b4(0x21b)],_0x408ca5['talt']);if(!_0x1bab8d||!_0x3b5a04)continue;if(_0x153341&&Math['abs'](_0x1bab8d[0x0]-_0x3b5a04[0x0])>=_0x29a3fb)continue;this['canvasContext']['moveTo'](_0x1bab8d[0x0],_0x1bab8d[0x1]),this['canvasContext'][_0x14b3b4(0x1bc)](_0x3b5a04[0x0],_0x3b5a04[0x1]);}this[_0x14b3b4(0x146)]['stroke']();}}['_tomap'](_0x433dab,_0x51d7b2,_0x236c42,_0x3fce8e){const _0x4c67db=_0x676d52,_0x11a0c9=Cesium[_0x4c67db(0x1a7)]['fromDegrees'](_0x51d7b2,_0x236c42,_0x3fce8e??this[_0x4c67db(0x1f2)]),_0x5b12bd=this['_map'][_0x4c67db(0x165)];if(_0x5b12bd[_0x4c67db(0x178)]===Cesium['SceneMode']['SCENE3D']){const _0x2498c4=new Cesium[(_0x4c67db(0x1c8))](_0x5b12bd['globe'][_0x4c67db(0x16c)],_0x5b12bd['camera']['positionWC']),_0x1b1948=_0x2498c4['isPointVisible'](_0x11a0c9);if(!_0x1b1948)return _0x433dab['age']=0x0,null;}const _0x2a0e79=mars3d__namespace['PointTrans']['toWindowCoordinates'](this['_map']['scene'],_0x11a0c9);return _0x2a0e79?[_0x2a0e79['x'],_0x2a0e79['y']]:null;}['clear'](){const _0x5142c2=_0x676d52;this['windField']['clear'](),delete this[_0x5142c2(0x1a5)];}[_0x676d52(0x206)](){const _0x2b3607=_0x676d52;this['worker']=new Worker(this[_0x2b3607(0x20c)]['worker']),this[_0x2b3607(0x17a)]['onmessage']=_0x5af5be=>{this['_drawLines'](_0x5af5be['data']['particles']),this['_updateIng2']=![];},this['windField']={'init':_0x13bdae=>{this['worker']['postMessage']({'type':'init','options':_0x13bdae});},'setOptions':_0x50c6f1=>{const _0x40a950=_0x2b3607;this['worker']['postMessage']({'type':_0x40a950(0x1f3),'options':_0x50c6f1});},'setDate':_0x3a59a6=>{const _0x34991a=_0x2b3607;this[_0x34991a(0x17a)][_0x34991a(0x1dc)]({'type':'setDate','data':_0x3a59a6});},'update':()=>{const _0x25b85e=_0x2b3607;if(this['_updateIng2'])return;this['_updateIng2']=!![],this[_0x25b85e(0x17a)]['postMessage']({'type':'update'});},'clear':()=>{const _0x26a32c=_0x2b3607;this[_0x26a32c(0x17a)][_0x26a32c(0x1dc)]({'type':'clear'});}},this['windField']['init'](this[_0x2b3607(0x20c)]);}}mars3d__namespace['LayerUtil'][_0x676d52(0x21e)](_0x676d52(0x15b),CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports[_0x676d52(0x195)]=CanvasWindLayer,exports[_0x676d52(0x214)]=WindLayer,exports[_0x676d52(0x1de)]=WindUtil,Object[_0x676d52(0x1fb)](exports,'__esModule',{'value':!![]});
}));
